<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; S: Linear Regression: Basics – RMS notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-method25.html" rel="next">
<link href="./07-method25.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="mnstyle.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-stat25.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">S: Linear Regression: Basics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">RMS notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">M: Research Questions and Claims</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">S: Data Management and Screening</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">M: Tools for Thinking About Causality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">S: Descriptive Statistics and Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">M: Measurement and Data Quality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">S: Point Estimates and Their Uncertainty</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">M: Within-participant Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-stat25.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">S: Linear Regression: Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">M: Randomized Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">S: Linear Regression: Single Predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">M: Broken Experiments and Quasi-experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">S: Linear Regression: Multiple Predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">M: Observational studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">S: Linear Regression: Non-linear Transformations and Interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">M: Fallacies and paradoxes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">S: Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#topics" id="toc-topics" class="nav-link active" data-scroll-target="#topics">Topics</a></li>
  <li><a href="#monotonic-versus-linear-relationship" id="toc-monotonic-versus-linear-relationship" class="nav-link" data-scroll-target="#monotonic-versus-linear-relationship"><span class="header-section-number">8.1</span> Monotonic versus linear relationship</a>
  <ul class="collapse">
  <li><a href="#anscombes-quartet" id="toc-anscombes-quartet" class="nav-link" data-scroll-target="#anscombes-quartet">Anscombe’s quartet</a></li>
  <li><a href="#non-parametric-smooting-lines-e.g.-lowess" id="toc-non-parametric-smooting-lines-e.g.-lowess" class="nav-link" data-scroll-target="#non-parametric-smooting-lines-e.g.-lowess">Non-parametric smooting lines, e.g., lowess()</a></li>
  <li><a href="#bootstrapped-confidence-interval-of-correlation-coefficient-optional" id="toc-bootstrapped-confidence-interval-of-correlation-coefficient-optional" class="nav-link" data-scroll-target="#bootstrapped-confidence-interval-of-correlation-coefficient-optional">Bootstrapped confidence interval of correlation coefficient (Optional!)</a></li>
  </ul></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">8.2</span> Linear regression</a>
  <ul class="collapse">
  <li><a href="#simple-example-regression-fake-data" id="toc-simple-example-regression-fake-data" class="nav-link" data-scroll-target="#simple-example-regression-fake-data">Simple example: Regression fake data</a></li>
  <li><a href="#interpretation-of-regression-coefficients" id="toc-interpretation-of-regression-coefficients" class="nav-link" data-scroll-target="#interpretation-of-regression-coefficients">Interpretation of regression coefficients</a></li>
  </ul></li>
  <li><a href="#regression-to-the-mean" id="toc-regression-to-the-mean" class="nav-link" data-scroll-target="#regression-to-the-mean"><span class="header-section-number">8.3</span> Regression to the mean</a></li>
  <li><a href="#general-linear-model-glm" id="toc-general-linear-model-glm" class="nav-link" data-scroll-target="#general-linear-model-glm"><span class="header-section-number">8.4</span> General linear model (glm)</a></li>
  <li><a href="#methods-for-estimating-regression-models" id="toc-methods-for-estimating-regression-models" class="nav-link" data-scroll-target="#methods-for-estimating-regression-models"><span class="header-section-number">8.5</span> Methods for estimating regression models</a>
  <ul class="collapse">
  <li><a href="#note-on-missing-data-and-complete-case-analysis" id="toc-note-on-missing-data-and-complete-case-analysis" class="nav-link" data-scroll-target="#note-on-missing-data-and-complete-case-analysis">Note on missing data and complete-case analysis</a></li>
  <li><a href="#lm-glm-and-stan_glm" id="toc-lm-glm-and-stan_glm" class="nav-link" data-scroll-target="#lm-glm-and-stan_glm">lm(), glm() and stan_glm()</a></li>
  </ul></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice">Practice</a>
  <ul class="collapse">
  <li><a href="#easy" id="toc-easy" class="nav-link" data-scroll-target="#easy">Easy</a></li>
  <li><a href="#medium" id="toc-medium" class="nav-link" data-scroll-target="#medium">Medium</a></li>
  <li><a href="#hard" id="toc-hard" class="nav-link" data-scroll-target="#hard">Hard</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">(Session Info)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">S: Linear Regression: Basics</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Load R-libraries</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the library "rstanarm" to fit Bayesian linear models using the function  </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stan_glm() </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="topics" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="topics">Topics</h2>
<div class="concepts">
<ul>
<li>Monotonic versus linear relationship</li>
<li>Coefficient of correlation
<ul>
<li>Pearson, standardized measure of linear trend</li>
<li>Spearman, standardized measure of monotonic trend</li>
<li>Anscombe’s quartet</li>
</ul></li>
<li>Non-parametric smoothing functions (e.g., <code>lowess()</code>)</li>
<li>(Bootstrapping of bivariate data. Optional, for the interested reader!)</li>
<li>Linear regression. Basic model: <span class="math inline">\(y = b_0 + b_1x + \epsilon\)</span>.
<ul>
<li>Regression coefficients, <span class="math inline">\(b_0\)</span> intercept, <span class="math inline">\(b_1\)</span> slope</li>
<li><span class="math inline">\(\epsilon\)</span> “error”, i.e., variability in the outcome not accounted for by the linear predictor:
<ul>
<li><code>lm()</code> calls it <em>Residual standard error</em></li>
<li><code>glm()</code> calls it <em>dispersion parameter</em> and reports it squared (variance)</li>
<li><code>stan_glm()</code> calls it <span class="math inline">\(\sigma\)</span></li>
</ul></li>
</ul></li>
<li><code>stan_glm()</code>: Understand output and how to obtain compatibility intervals using the function <code>posterior_interval()</code></li>
<li>Regression to the mean. Be aware of fallacies!</li>
<li>General Linear Model (GLM), basic model plus assumption of normal distribution:<br>
<span class="math inline">\(y_i \sim Normal(\mu_i, \sigma)\)</span><br>
<span class="math inline">\(\mu_i = b_0 + b_1x_i\)</span></li>
<li>Estimating regression models, three methods:
<ul>
<li>Ordinary Least Squares (OLS)</li>
<li>Maximum likelihood</li>
<li>Bayesian inference</li>
</ul></li>
</ul>
<p>Readings.</p>
<ul>
<li><span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, Chapter 6 (you may also read Chapter 5, section 5.4 on bootstrapping). Note: The book does not discuss Spearman’s coefficients of correlation and says little about Pearson’s. This probably reflects the author’s general preference for meaningful units and unstandardized effect size estimates. See my example below for how to derive compatibility intervals around a correlation coefficient, using bootstrapping.</li>
</ul>
</div>
</section>
<section id="monotonic-versus-linear-relationship" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="monotonic-versus-linear-relationship"><span class="header-section-number">8.1</span> Monotonic versus linear relationship</h2>
<ul>
<li><strong>Linear relationship</strong>. X and Y are perfectly linearly related if data fall on a straight line in a scatter-gram, i.e., <span class="math inline">\(Y = b_0 + b_1X\)</span>.</li>
<li><strong>Monotonic relationship</strong>. (a) Y <em>increases</em> or stay the same for every increase in X, or (b) Y <em>decreases</em> or stay the same for every increase in X. All linear relationships are monotonic, but not all monotonic relationships are linear.</li>
<li><strong>Pearson’s coefficient of correlation</strong>: <span class="math inline">\(r_{x, y} = \frac{Cov(x, y)}{\sqrt{Var(x)Var(y)}}\)</span>. <span class="math inline">\(r_{x, y}\)</span> is a measure of the degree to which two variables are <em>linearly</em> related.</li>
<li><strong>Spearman’s coefficient of correlation</strong> is defined as the Pearson correlation coefficient between the ranked variables. It is a measure of the degree to which two variables are <em>monotonically</em> related.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These are just examples</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span>    <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ylin <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ymon <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">2.1</span>, <span class="fl">4.7</span>, <span class="fl">5.1</span>, <span class="fl">5.2</span>, <span class="fl">5.5</span>, <span class="dv">8</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, x, <span class="at">pch =</span> <span class="st">''</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>), <span class="at">ylab =</span> <span class="st">'ylin (black), ymon (blue)'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, ylin, <span class="at">type =</span> <span class="st">'b'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, ymon, <span class="at">type =</span> <span class="st">'b'</span>, <span class="at">col =</span> <span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, ylin, ymon)  <span class="co"># Put variables in a data frame</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cor</span>(rr, <span class="at">method =</span> <span class="st">'pearson'</span>),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        x ylin ymon
x    1.00 1.00 0.94
ylin 1.00 1.00 0.94
ymon 0.94 0.94 1.00</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(rr, <span class="at">method =</span> <span class="st">'spearman'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     x ylin ymon
x    1    1    1
ylin 1    1    1
ymon 1    1    1</code></pre>
</div>
</div>
<p><br></p>
<section id="anscombes-quartet" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="anscombes-quartet">Anscombe’s quartet</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Anscombe's quartet data, it's in R</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> anscombe</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the quartet using this function</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>myplot <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, y, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">20</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">13</span>), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">'darkgrey'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  mfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(mfit)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  pear <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">'pearson'</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  spear <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">'spearman'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="dv">18</span>, <span class="dv">5</span>, <span class="fu">round</span>(pear, <span class="dv">2</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="dv">18</span>, <span class="dv">4</span>, <span class="fu">round</span>(spear, <span class="dv">2</span>), <span class="at">col =</span> <span class="st">'lightblue'</span>)  <span class="co">#Spearman in blue</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix default settings of plotting: 2x2 panels and fix margins of figures</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Use function to plot</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">myplot</span>(d<span class="sc">$</span>x1, d<span class="sc">$</span>y1)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">myplot</span>(d<span class="sc">$</span>x2, d<span class="sc">$</span>y2)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">myplot</span>(d<span class="sc">$</span>x3, d<span class="sc">$</span>y3)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu">myplot</span>(d<span class="sc">$</span>x4, d<span class="sc">$</span>y4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="non-parametric-smooting-lines-e.g.-lowess" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="non-parametric-smooting-lines-e.g.-lowess">Non-parametric smooting lines, e.g., lowess()</h3>
<p>Example using data from <span class="citation" data-cites="howell2012statistical">Howell (<a href="references.html#ref-howell2012statistical" role="doc-biblioref">2012</a>)</span> (Fig 9.2).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data: Pace of life and Incidence of Heart Disease in 36 US cities</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pace <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">27.67</span>, <span class="fl">25.33</span>,<span class="fl">23.67</span>, <span class="fl">26.33</span>, <span class="fl">26.33</span>, <span class="fl">25.00</span>, <span class="fl">26.67</span>, <span class="fl">26.33</span>, <span class="fl">24.33</span>, <span class="fl">25.67</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>          <span class="fl">22.67</span>, <span class="fl">25.00</span>, <span class="fl">26.00</span>, <span class="fl">24.00</span>, <span class="fl">26.33</span>, <span class="fl">20.00</span>, <span class="fl">24.67</span>, <span class="fl">24.00</span>, <span class="fl">24.00</span>, <span class="fl">20.67</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>          <span class="fl">22.33</span>, <span class="fl">22.00</span>, <span class="fl">19.33</span>, <span class="fl">19.67</span>, <span class="fl">23.33</span>, <span class="fl">22.33</span>, <span class="fl">20.33</span>, <span class="fl">23.33</span>, <span class="fl">20.33</span>, <span class="fl">22.67</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>          <span class="fl">20.33</span>, <span class="fl">22.00</span>, <span class="fl">20.00</span>, <span class="fl">18.00</span>, <span class="fl">16.67</span>, <span class="fl">15.00</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>heart <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">29</span>, <span class="dv">31</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">26</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">25</span>, <span class="dv">14</span>, <span class="dv">11</span>, <span class="dv">19</span>, <span class="dv">24</span>, <span class="dv">20</span>, <span class="dv">13</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">16</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">11</span>, <span class="dv">27</span>, <span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">21</span>, <span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">19</span>, <span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data (Fig. 9.2)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pace, heart, <span class="at">xlab =</span> <span class="st">"Pace of life [a.u.]"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Age-adjusted rate of heart disease"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw smoothing curve</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(pace, heart), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw linear regression line</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(heart <span class="sc">~</span> pace), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bootstrapped-confidence-interval-of-correlation-coefficient-optional" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="bootstrapped-confidence-interval-of-correlation-coefficient-optional">Bootstrapped confidence interval of correlation coefficient (Optional!)</h3>
<p>This section is optional (no exam questions on Bootstrapping!).</p>
<p>Below example how to do derive a confidence interval around Spearman’s rho with Bootstrapping. Data is on activity of cats and their preference for food-puzzles (this is data from a paper discussed at previous year’s Research methods 1.)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function that takes random pairs of observations from the sample with </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># replacement and calculates a correlation. m = number of observations in the </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sample = nrow(d)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>do_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  rownumber <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(pace), <span class="at">size =</span> <span class="fu">length</span>(pace), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  pp <span class="ot">&lt;-</span> pace[rownumber]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  hh <span class="ot">&lt;-</span> heart[rownumber]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(pp, hh, <span class="at">method =</span> <span class="st">"spearman"</span>)  <span class="co"># Please try method = "pearson"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>activity <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4286.30</span>, <span class="fl">5548.30</span>, <span class="fl">10122.30</span>, <span class="fl">6306.48</span>, <span class="fl">3631.64</span>, <span class="cn">NA</span>, <span class="fl">3745.55</span>, <span class="fl">4143.21</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                <span class="fl">3895.82</span>, <span class="fl">5147.45</span>, <span class="fl">4656.12</span>, <span class="fl">3843.03</span>, <span class="fl">5655.86</span>, <span class="fl">4820.61</span>, <span class="fl">6723.03</span>, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                <span class="fl">3447.50</span>, <span class="fl">3710.67</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>cf_time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.665540690</span>, <span class="fl">0.457864800</span>, <span class="fl">0.344189459</span>, <span class="fl">0.774329406</span>, <span class="fl">0.062175325</span>, </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.438901412</span>, <span class="fl">0.869390384</span>, <span class="fl">0.064502761</span>, <span class="fl">0.661828747</span>, <span class="fl">0.123849917</span>, </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.486835855</span>, <span class="fl">0.016898694</span>, <span class="fl">0.005084774</span>, <span class="fl">0.210401442</span>, <span class="fl">0.138330489</span>, </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.001552313</span>, <span class="fl">0.326076928</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>cats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(activity, cf_time)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>cats <span class="ot">&lt;-</span> cats[<span class="fu">complete.cases</span>(cats), ]  <span class="co"># Remove rows with missing data</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot relationship</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cats<span class="sc">$</span>activity, cats<span class="sc">$</span>cf_time, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"grey"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Cat activity [activity measure from some device]"</span>, </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Proportion time spent on food puzzle (vs. tray)"</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add smoothing curve to plot</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(cats<span class="sc">$</span>activity, cats<span class="sc">$</span>cf_time), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Add spearman coef all data, and with extreme x-value removed</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>spear <span class="ot">&lt;-</span> <span class="fu">cor</span>(cats<span class="sc">$</span>activity, cats<span class="sc">$</span>cf_time, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>spear2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(cats<span class="sc">$</span>activity[cats<span class="sc">$</span>activity <span class="sc">&lt;</span> <span class="dv">9000</span>], </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>             cats<span class="sc">$</span>cf_time[cats<span class="sc">$</span>activity <span class="sc">&lt;</span> <span class="dv">9000</span>], </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">8500</span>, <span class="at">y =</span> <span class="fl">0.95</span>,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sprintf</span>(<span class="st">"Spearman's rho = %0.2f </span><span class="sc">\n</span><span class="st">(with extreme x-value removed: %0.2f)"</span>, </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>             spear, spear2), <span class="at">cex =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Bootstrap 95 % CI:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>do_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  rownumber <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(cats), <span class="at">size =</span> <span class="fu">nrow</span>(cats), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  cc <span class="ot">&lt;-</span> cats[rownumber, ]  <span class="co"># Select rows from data frame</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(cc<span class="sc">$</span>activity, cc<span class="sc">$</span>cf_time, <span class="at">method =</span> <span class="st">"spearman"</span>) </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the bootstrap</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="at">n =</span> <span class="fl">1e4</span>, <span class="fu">do_stat</span>())</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate confidence interval</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(boots, <span class="at">breaks =</span> <span class="dv">100</span>, <span class="at">main =</span> <span class="st">"Bootstrapped Spearman's rho"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bootci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boots, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(bootci, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 2.5% 97.5% 
-0.38  0.69 </code></pre>
</div>
</div>
<p><br></p>
<p>My interpretation: The result was inconclusive with regard to a monotonic relationship between activity and relative time spent on the food puzzle. Spearman’s rho was positive (0.21), but the compatibility interval [-0.38, 0.69] was wide and included substantial negative as well as positive coefficients.</p>
<p>Compare with the author’s (questionable) interpretation : “There was no correlation between CFtime and activity, Spearman correlation coefficient r(16) = 0.21, p = 0.44.”</p>
<p><br></p>
</section>
</section>
<section id="linear-regression" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="linear-regression"><span class="header-section-number">8.2</span> Linear regression</h2>
<p>Basic regression model <span class="citation" data-cites="gelman2020regression">(<a href="references.html#ref-gelman2020regression" role="doc-biblioref">Gelman et al., 2021, p. 81</a>)</span>:</p>
<p><span class="math inline">\(y = b_0 + b_1x + \epsilon\)</span>,</p>
<p>where <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> are <em>regression coefficients</em>, and <span class="math inline">\(\epsilon\)</span> is “error” or variability not related to the predictor <span class="math inline">\(x\)</span>. (See below, <em>General Linear Model</em> for additional assumptions and a more transparent notation of the model, where “error” will be called <span class="math inline">\(\sigma\)</span>).</p>
<p><br></p>
<p>In this course we will also consider four extensions of this basic model, namely</p>
<ul>
<li>Several predictors, that is, multiple regression: <span class="math inline">\(y = b_0 + b_1x_1 + b_2x_2, + ... + b_kx_k + \epsilon\)</span>,</li>
<li>Nonlinear models, such as: <span class="math inline">\(y = b_0 + b_1log(x) + \epsilon\)</span>,<br>
</li>
<li>Nonadditive models with an interaction term: <span class="math inline">\(y = b_0 + bx_1 + bx_2 + bx_1bx_2 + \epsilon\)</span>,<br>
</li>
<li>Logistic regression: A generalized linear model of binary outcomes.</li>
</ul>
<p><br></p>
<section id="simple-example-regression-fake-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="simple-example-regression-fake-data">Simple example: Regression fake data</h3>
<p>We will simulate some data. I am using the code from Gelman et al.&nbsp; (2020; Section 6.2, p.&nbsp;82).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># set.seed() not given in the book, so we cannot reproduce exactly!</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">0.2</span>  <span class="co"># Intercept</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">0.3</span>  <span class="co"># Slope </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># This is the "error" component (epsilon)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)  <span class="co"># Note: Gelman et al. </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># coded  the last term </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># +  sigma*rnorm(n); same thing.</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>fake <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fake<span class="sc">$</span>x, fake<span class="sc">$</span>y, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"grey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Below I use the <code>lm()</code> function to fit a line to the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_1)  <span class="co"># Summary stat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.99395 -0.30140 -0.01884  0.25971  0.86677 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.35505    0.23100   1.537    0.142    
x            0.29198    0.01928  15.141  1.1e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4973 on 18 degrees of freedom
Multiple R-squared:  0.9272,    Adjusted R-squared:  0.9232 
F-statistic: 229.3 on 1 and 18 DF,  p-value: 1.102e-11</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit_1)  <span class="co"># Confidence intervals (we call them "compatibility intervals")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept) -0.1302658 0.8403583
x            0.2514646 0.3324908</code></pre>
</div>
</div>
<p>Here a plot corresponding to Gelman et al.’s Fig. 6.1.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fake<span class="sc">$</span>x, fake<span class="sc">$</span>y, <span class="at">main =</span> <span class="st">"Data and fitted regression line"</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"grey"</span>)  <span class="co"># Plot data</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit_1)  <span class="co"># Add regression line</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text with regression equation</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>a_hat <span class="ot">&lt;-</span> fit_1<span class="sc">$</span>coefficients[<span class="dv">1</span>]  <span class="co"># Intercept</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>b_hat <span class="ot">&lt;-</span> fit_1<span class="sc">$</span>coefficients[<span class="dv">2</span>]  <span class="co"># Slope</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>equation <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"y = %.2f + %.2fx"</span>, a_hat, b_hat)  <span class="co"># As text</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">mean</span>(fake<span class="sc">$</span>x) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="fu">mean</span>(fake<span class="sc">$</span>y), equation, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Here I fit the same model as above using <code>stan_glm()</code>. See, Gelman et al.&nbsp;p.&nbsp;82, but note that I added the option <code>refresh = 0</code> in <code>stan_glm()</code> to suppress the Stan’s sampling-progress output.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> fake, <span class="at">refresh =</span> <span class="dv">0</span>)  <span class="co"># library(rstanarm)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_1, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       gaussian [identity]
 formula:      y ~ x
 observations: 20
 predictors:   2
------
            Median MAD_SD
(Intercept) 0.36   0.24  
x           0.29   0.02  

Auxiliary parameter(s):
      Median MAD_SD
sigma 0.52   0.09  

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "Posterior uncertainty intervals"", often called "credible interval", but we </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># call them "Compatibility intervals"!</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ci95 <span class="ot">&lt;-</span> <span class="fu">posterior_interval</span>(fit_1, <span class="at">prob =</span> <span class="fl">0.95</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(ci95, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              2.5% 97.5%
(Intercept) -0.117 0.870
x            0.249 0.332
sigma        0.383 0.768</code></pre>
</div>
</div>
<p><br></p>
<p>Here is a table corresponding to Gelman et al.’s Fig. 6.2, but I added a column for compatibility intervals</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 18%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Parameter</th>
<th style="text-align: center;">Assumed value</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Uncertainty</th>
<th style="text-align: center;">95 % CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(a\)</span></td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">0.36</td>
<td style="text-align: center;">0.24</td>
<td style="text-align: center;">[-0.12, 0.87]</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(b\)</span></td>
<td style="text-align: center;">0.3</td>
<td style="text-align: center;">0.29</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">[0.25, 0.33]</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\sigma\)</span></td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">0.52</td>
<td style="text-align: center;">0.09</td>
<td style="text-align: center;">[0.38, 0.77]</td>
</tr>
</tbody>
</table>
<p>Note.</p>
<ul>
<li><strong>Parameter</strong>, is the intercept, <span class="math inline">\(a\)</span>, slope, <span class="math inline">\(b\)</span>, and unaccounted variability (“error”), <span class="math inline">\(\sigma\)</span> of the fitted linear model.</li>
<li><strong>Assumed value</strong> is the “true” population value according to our simulated scenario.</li>
<li><strong>Estimate</strong> is the point estimate of the population parameter.</li>
<li><strong>Uncertainty</strong> is the “standard error” of the estimate (i.e, “standard error” in the general interpretation of the term, here calculated as the MAD-SD of the posterior distribution).</li>
<li><strong>95 % CI</strong> is the 95 % Compatibility interval around the estimate (this interval is also known as the Posterior uncertainty interval or credible interval).</li>
</ul>
<p><br></p>
</section>
<section id="interpretation-of-regression-coefficients" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretation-of-regression-coefficients">Interpretation of regression coefficients</h3>
<p>The intercept is the predicted mean value of the outcome when x = 0. The regression coefficient (“slope”) represents the difference in the outcome for each one-unit difference in the predictor. Example: If the outcome is weight (measured in kg) and the predictor is height (measured in cm), the slope’s unit would be kg/cm.</p>
<p>Note that the slope can <em>always</em> be interpreted as a comparison: It is a difference between the average outcomes of observations with predictor values of <span class="math inline">\(x+1\)</span> vs.&nbsp;<span class="math inline">\(x\)</span>.</p>
<p>Sometimes the slope parameter can also be interpreted as a causal effect, for example, the between-group difference in a randomized experiment. If the treatment variable, T, is an indicator with treatment group coded 1 and control group coded 0, the regression coefficient for T can be interpreted as the average causal effect of the treatment on the outcome. This may be viewed as an estimate of the average difference between potential outcomes: one where everyone was tested under the treatment condition and another where everyone was tested under the control condition. Interpreting the observed coefficient as a causal-effect estimate requires strong assumptions. Therefore, it is generally safer to interpret a regression parameter as a difference between groups rather than as a causal effect. See section 6.3 and elsewhere in <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>.</p>
<p><br></p>
</section>
</section>
<section id="regression-to-the-mean" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="regression-to-the-mean"><span class="header-section-number">8.3</span> Regression to the mean</h2>
<ul>
<li>Success: Talent + luck; Great success: A little more talent + much more luck.</li>
<li>Sports Illustrated Jinx.</li>
<li>A flurry of deaths by natural causes in a village led to speculation about some new and unusual threat. A group of priests attributed the problem to the sacrilege of allowing women to attend funerals, formerly a forbidden practice. The remedy was a decree that barred women from funerals in the area. The decree was quickly enforced, and the rash of unusual deaths subsided. This proves that the priests were correct.</li>
<li>Old exam question: “Children of chess world-champions are likely to become proficient chess players, but so far none have reached the top 100, presumably because chess world champions tend to be selfish persons unwilling to share their knowledge with others, including their children”. Find an alternative explanation</li>
</ul>
<p><br></p>
<p>Simulating fake data on students who take two tests, see Gelman et al., p.89.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>true_ability <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>noise_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>noise_2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>midterm <span class="ot">&lt;-</span> true_ability <span class="sc">+</span> noise_1</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span>   true_ability <span class="sc">+</span> noise_2</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>exams <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(midterm, final)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(exams)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   midterm    final
1 34.43726 39.27921
2 37.29867 50.06760
3 65.40728 60.17119
4 49.38333 62.89736
5 25.79945 53.03424
6 77.55638 60.99797</code></pre>
</div>
</div>
<p><br></p>
<p>Plot data and add a regression line</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(exams<span class="sc">$</span>midterm, exams<span class="sc">$</span>final, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression analysis to fit line to data</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(final <span class="sc">~</span> midterm, <span class="at">data =</span> exams, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines to plot</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(fit_1))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>xyline <span class="ot">&lt;-</span> <span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>)  <span class="co"># Line x = y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show regression estimates</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_1, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       gaussian [identity]
 formula:      final ~ midterm
 observations: 1000
 predictors:   2
------
            Median MAD_SD
(Intercept) 24.91   1.37 
midterm      0.50   0.03 

Auxiliary parameter(s):
      Median MAD_SD
sigma 11.72   0.27 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">posterior_interval</span>(fit_1, <span class="at">prob =</span> <span class="fl">0.95</span>), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             2.5% 97.5%
(Intercept) 22.27 27.63
midterm      0.44  0.54
sigma       11.22 12.26</code></pre>
</div>
</div>
<p><br></p>
<p>Note: Regression analysis actually assume that there is no measurement error in the predictor. So this assumption was violated by the analysis above. However, for prediction of final exam scores from mid-term exam scores, it make sense to treat the latter as fixed, simply because they are fixed (as exam scores tend to be).</p>
</section>
<section id="general-linear-model-glm" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="general-linear-model-glm"><span class="header-section-number">8.4</span> General linear model (glm)</h2>
<div class="cell" type="citations">
<div class="citations">
<p>
All models are wrong, but some are useful(<span class="citation"><span class="citation" data-cites="box1979robustness">Box (<a href="references.htmlreferences.html#ref-box1979robustness" role="doc-biblioref">1979</a>)</span></span>)
</p>
</div>
</div>
<p><br></p>
<p>The basic regression model <span class="citation" data-cites="gelman2020regression">(see <a href="references.html#ref-gelman2020regression" role="doc-biblioref">Gelman et al., 2021, p. 81</a>)</span>:</p>
<p><span class="math inline">\(y_i = b_0 + b_1x_i + \epsilon_i\)</span>, for <span class="math inline">\(i = 1, 2, ..., n\)</span> observations.</p>
<p>We typically assume that the “errors”, <span class="math inline">\(\epsilon_i\)</span>, are independent and normally distributed with mean = 0 and a fixed standard deviation <span class="math inline">\(\sigma\)</span>:<br>
<span class="math inline">\(\epsilon_i \sim Normal(0, \sigma)\)</span>.</p>
<p>Given these assumptions, we can write the linear regression model as:</p>
<p><span class="math inline">\(y_i \sim Normal(\mu_i, \sigma)\)</span><br>
<span class="math inline">\(\mu_i = b_0 + b_1x_i\)</span></p>
<p>The first line is the probabilistic part of the model, sometimes called the <em>likelihood</em>, that relates to irreducible “error”, that is, variation around predicted values (implied by <span class="math inline">\(\sigma)\)</span>).</p>
<p>The second line is the deterministic part, we will call it the <em>linear predictor</em> of the model. It gives the predicted mean <span class="math inline">\(\mu_i\)</span> of observations for given value of the predictor, <span class="math inline">\(x_i\)</span> (or values of several predictors when we move to multiple regression),</p>
<p>The model imply infinitely many normal distributions, one for each possible value of x, and each with the same standard deviation (an assumption known as <em>homoscedasticity</em>).<br>
Here these model implications are illustrated for a few x-values: 10, 20, …, 90.</p>
<p>(Code only for nerds.)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">2</span>), <span class="dv">10</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>x</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw scattergram with regression line</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>mfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>sd_res <span class="ot">&lt;-</span> <span class="fu">sd</span>(mfit<span class="sc">$</span>residuals)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">ylim =</span> ylim)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mfit, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add normal curves</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>drawnormal <span class="ot">&lt;-</span> <span class="cf">function</span>(x_input) {</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="ot">&lt;-</span> mfit<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="sc">+</span> mfit<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>x_input</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  sd_res <span class="ot">&lt;-</span> <span class="fu">sd</span>(mfit<span class="sc">$</span>residuals)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> <span class="fu">seq</span>(y_pred <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> sd_res, y_pred <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> sd_res, <span class="dv">1</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  dx <span class="ot">&lt;-</span> x_input <span class="sc">-</span> <span class="fu">dnorm</span>(xx, <span class="at">mean =</span> y_pred, <span class="at">sd =</span> sd_res) <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(dx, xx, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(x_input, y_pred, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(x_input, x_input), ylim, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span> )</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Invisible() supresses unwanted output from sapply()</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">90</span>, <span class="dv">10</span>), drawnormal))</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Add regression equation</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rect</span>(<span class="dv">0</span>, <span class="dv">170</span>, <span class="dv">29</span>, <span class="dv">200</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">border =</span> <span class="cn">NA</span>)  <span class="co"># White box</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">round</span>(mfit<span class="sc">$</span>coefficients[<span class="dv">1</span>], <span class="dv">1</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">round</span>(mfit<span class="sc">$</span>coefficients[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>sres <span class="ot">&lt;-</span> <span class="fu">round</span>(sd_res, <span class="dv">1</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>equation1 <span class="ot">=</span> <span class="fu">bquote</span>(y[i] <span class="sc">~</span> <span class="st">"~"</span> <span class="sc">~</span> <span class="fu">Normal</span>(mu[i], sigma <span class="sc">==</span> <span class="er">~</span> .(sres)))</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>equation2 <span class="ot">=</span> <span class="fu">bquote</span>(mu[i] <span class="sc">==</span> <span class="er">~</span> .(b0) <span class="sc">~</span> <span class="st">"+"</span> <span class="sc">~</span> .(b1) <span class="sc">~</span> x[i])</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span>, <span class="dv">190</span>, equation1, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span>, <span class="dv">180</span>, equation2, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="methods-for-estimating-regression-models" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="methods-for-estimating-regression-models"><span class="header-section-number">8.5</span> Methods for estimating regression models</h2>
<p>Three methods for estimating parameters of a regression model:</p>
<ul>
<li><strong>Ordinary Least squares</strong> &nbsp;Minimizing the residual sum of squares. This is the classical method, in <code>R</code> we use <code>lm()</code> to obtain least square estimates.</li>
<li><strong>Maximum likelihood</strong> &nbsp;Maximizing the <em>likelihood function</em> (more below). In <code>R</code>, the most common choice is to use <code>glm()</code>. However, maximum likelihood estimation is the same as Bayesian inference without priors, and can be implemented in <code>stan_glm()</code> with non-default arguments, see <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, p.&nbsp;110.</li>
<li><strong>Bayesian inference</strong> &nbsp;Estimates the <em>posterior distribution</em> of parameters. The posterior is a compromise between the data (likelihood function) and prior beliefs (prior distribution), as described in more detail below. In <code>R</code> we can use <code>stan_glm()</code> to make Bayesian inference (using a Markov Chain Monte Carlo (MCMC) method). If the user does not specify priors, <code>stan_glm()</code> uses default priors.</li>
</ul>
<p>For reasonably large data sets, the three methods give very similar estimates, as illustrated below.</p>
<p><br></p>
<section id="note-on-missing-data-and-complete-case-analysis" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="note-on-missing-data-and-complete-case-analysis">Note on missing data and complete-case analysis</h3>
<p>When faced with missing data, most software automatically applies a complete-case analysis—also known as list-wise deletion—by excluding all study units with missing values on any variables included in the regression model. This process is typically performed without warning, so it’s important to be mindful that it can result in a significant reduction in sample size. Additionally, it may introduce bias if the missingness is related to other variables, including those not measured, that could confound the relationship between the outcome and predictors.</p>
<p>If there is a substantial amount of missing data, it’s advisable to also perform analyses using a simple data imputation method (see <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, section 17.4; summarized in these notes, 11.4). Ideally, the interpretation of results will remain consistent. However, if the results change, careful consideration is required to determine the best course of action. In such cases, more advanced imputation methods may be necessary—refer to <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, section 17.5 for further guidance.</p>
<p><br></p>
</section>
<section id="lm-glm-and-stan_glm" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="lm-glm-and-stan_glm">lm(), glm() and stan_glm()</h3>
<p>Data in figure above</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here data again, so you don't have to search for it in the code above!</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">2</span>), <span class="dv">10</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>x</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Model to be fitted to data:</p>
<p><span class="math inline">\(y_i \sim Normal(\mu_i, \sigma)\)</span><br>
<span class="math inline">\(\mu_i = b_0 + b_1x_i\)</span></p>
<p><br></p>
<p>Main task is to estimate intercept (<span class="math inline">\(b_0\)</span>) and slope (<span class="math inline">\(b_1\)</span>) of our linear model, <span class="math inline">\(\mu_i = b_0 + b_1x_i\)</span>. <code>stan_glm()</code> will also give us an estimate of the standard deviation around the line (sigma, <span class="math inline">\(\sigma\)</span>).</p>
<p><br></p>
<p>Model fit, using lm()</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data in data frame</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit using lm(), i.e. Ordinary Least Squares</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dd) </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = dd)

Residuals:
    Min      1Q  Median      3Q     Max 
-56.775 -13.776   0.144  12.880  53.079 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 48.97230    1.81081   27.04   &lt;2e-16 ***
x            0.81961    0.03135   26.14   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 20.23 on 498 degrees of freedom
Multiple R-squared:  0.5785,    Adjusted R-squared:  0.5776 
F-statistic: 683.5 on 1 and 498 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept) 45.4145258 52.5300794
x            0.7580113  0.8812017</code></pre>
</div>
</div>
<p><br></p>
<p>Model above, using glm()</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dd)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ x, data = dd)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 48.97230    1.81081   27.04   &lt;2e-16 ***
x            0.81961    0.03135   26.14   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 409.2695)

    Null deviance: 483544  on 499  degrees of freedom
Residual deviance: 203816  on 498  degrees of freedom
AIC: 4430.1

Number of Fisher Scoring iterations: 2</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                2.5 %    97.5 %
(Intercept) 45.423172 52.521433
x            0.758161  0.881052</code></pre>
</div>
</div>
<p><br></p>
<p>Model above, using stan_glm()</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)  <span class="co"># stan_glm prefer data to be stored in a data frame</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fit_stan_glm <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dd, <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_stan_glm, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       gaussian [identity]
 formula:      y ~ x
 observations: 500
 predictors:   2
------
            Median MAD_SD
(Intercept) 49.01   1.83 
x            0.82   0.03 

Auxiliary parameter(s):
      Median MAD_SD
sigma 20.26   0.63 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">posterior_interval</span>(fit_stan_glm, <span class="at">prob =</span> <span class="fl">0.95</span>), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              2.5%  97.5%
(Intercept) 45.458 52.519
x            0.759  0.881
sigma       19.060 21.622</code></pre>
</div>
</div>
<p><br></p>
<p><strong>Below is for advanced users</strong></p>
<p><code>stan_glm()</code> does Bayesian estimation of the model parameters. In our simple example above, we have three parameters: Intercept (<span class="math inline">\(b_0\)</span>), slope (<span class="math inline">\(b_1\)</span>), and standard deviation around the regression line (<span class="math inline">\(\sigma\)</span>). The <code>stan_glm()</code>-algorithm (called “Hamiltonian Monte Carlo”, HMC) samples many sets of parameters, each set with three values &lt;<span class="math inline">\(b_0\)</span>, <span class="math inline">\(b_1\)</span>, <span class="math inline">\(\sigma\)</span>&gt;. HMC does this this in a clever way that assure that parameter-sets that fit the data better are more likely to be sampled. The default is to collect 4000 sets of parameters. The sampled parameters are stored and can be used for further data analysis.</p>
<p>Here an example, where I draw many regression lines, each a reasonable line given the data and default priors used by <code>stan_glm()</code> (default is weak priors, meaning that they will not yield estimates different from approaches like <code>glm()</code> that does not account for prior beliefs in the estimation).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame with sampled parameter values</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(fit_stan_glm)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename parameters according to model notation above</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ss) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"b0"</span>, <span class="st">"b1"</span>, <span class="st">"sigma"</span>)  </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        b0        b1    sigma
1 46.38761 0.8591003 21.16674
2 50.51860 0.8152445 20.50395
3 50.27949 0.8287463 20.34503
4 50.32700 0.7915958 20.69936
5 52.26407 0.7799136 21.18584
6 52.26827 0.7778340 20.67591</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dd<span class="sc">$</span>x, dd<span class="sc">$</span>y)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a random sample of other lines. Use transparent color to see where most fall</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>  <span class="co"># Number of lines to show</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>rrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ss), <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>rlines <span class="ot">&lt;-</span> ss[rrows, <span class="sc">-</span><span class="dv">3</span>]  <span class="co"># n lines</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines using for loop</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">&lt;-</span> rlines[j, <span class="dv">1</span>] <span class="sc">+</span> rlines[j, <span class="dv">2</span>] <span class="sc">*</span> xx</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(xx, yy, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.2</span>))</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add "best" line, defined by point estimates of b0 and b1</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit_stan_glm, <span class="at">lwd =</span> <span class="fl">1.5</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>This code show the full posterior for the slope parameter, <span class="math inline">\(b_1\)</span>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This extract the parameter values that stan sampled from the posterior </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution using a specific Markow Chain Monte Carlo (MCMC) method called </span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hamiltonian Monte Carlo</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(fit_stan_glm)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>bx <span class="ot">&lt;-</span> ss<span class="sc">$</span>x  <span class="co"># Subset slope parameter</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Here a density plot of the sampled x coefficients. This is our estimate </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># of the slope parameter.</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot density curve for sigma</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(bx), <span class="at">xlab =</span> <span class="st">"Slope parameter"</span>, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Posterior probability: Slope parameter, with 95 and 50 % CI"</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive point estimate and compatibility interval</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>point_estimate <span class="ot">&lt;-</span> <span class="fu">median</span>(bx)  <span class="co"># This is summary value preferred by stan_glm</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>ci95 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bx, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>ci50 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bx, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot point estimate and compatibility interval</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> ci95[<span class="dv">1</span>], <span class="at">x1 =</span> ci95[<span class="dv">2</span>], <span class="at">y0 =</span> <span class="fl">0.01</span>, <span class="at">y1 =</span> <span class="fl">0.01</span>, </span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">length =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> ci50[<span class="dv">1</span>], <span class="at">x1 =</span> ci50[<span class="dv">2</span>], <span class="at">y0 =</span> <span class="fl">0.01</span>, <span class="at">y1 =</span> <span class="fl">0.01</span>, </span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">length =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(point_estimate, <span class="fl">0.01</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">'lightblue'</span>)  <span class="co"># Add point"</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Point estimate and MAD SD to confirm that the values are the same </span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co"># as stan_glm reported in print(fit_stan_glm)</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>post_mad <span class="ot">&lt;-</span> <span class="fu">mad</span>(bx)</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>posterior_summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">point_est =</span> point_estimate, <span class="at">MAD_SD =</span> post_mad)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to plot</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>text2plot <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"Median  = %.2f, MAD_SD =  %.2f"</span>, </span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(point_estimate, <span class="dv">2</span>), <span class="fu">round</span>(post_mad, <span class="dv">2</span>))</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.85</span>, <span class="dv">10</span>, text2plot, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print to console</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(posterior_summary, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>point_est    MAD_SD 
    0.820     0.031 </code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="practice" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="practice">Practice</h2>
<p>The practice problems are labeled Easy (E), Medium (M), and Hard (H), (as in <span class="citation" data-cites="McElreath2020">McElreath (<a href="references.html#ref-McElreath2020" role="doc-biblioref">2020</a>)</span>).</p>
<section id="easy" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="easy">Easy</h3>
<div class="practice">
<p><strong>8E1.</strong> Pearson’s coefficient of correlation, <span class="math inline">\(r_{x, y}\)</span> is sometimes misleading. Illustrate this graphically in scattergrams for each of the examples below:</p>
<ol type="a">
<li><span class="math inline">\(r_{x, y}\)</span> is too low because of a restriction in range.</li>
<li><span class="math inline">\(r_{x, y}\)</span> is too high because of an outlier.</li>
<li><span class="math inline">\(r_{x, y}\)</span> is close to zero because of a strong non-linear relationship</li>
<li><span class="math inline">\(r_{x, y}\)</span> is high but less than 1.0 because of a perfect non-linear relationship.</li>
</ol>
<p>(Old exam question)</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>8E2.</strong></p>
<ol type="a">
<li>Would you expect the relationship between weight [kg] and age [years] in children (0-18 years) to be linear, monotonic or non-monotonic?</li>
<li>How about adults (18-100 years)?</li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>8E3.</strong> Estimate by eye the intercept and slope of each of the four lines in the plot.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">pch=</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">11</span>), <span class="at">ylim =</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<div class="practice">
<p><strong>8E4.</strong> Draw lines illustrating these linear functions, assuming x is a continuous variable, and estimate by eye the values of <span class="math inline">\(b_0\)</span>, and <span class="math inline">\(b_1\)</span> from your drawings.</p>
<ol type="a">
<li><span class="math inline">\(y_i = b_0 + b_1 x_i\)</span></li>
<li><span class="math inline">\(y_i = b_1 x_i\)</span></li>
<li><span class="math inline">\(y_i = b_0\)</span></li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>8E5.</strong> Draw by hand scatter grams illustrating (made up) data and regression lines for these linear models. Assume x to be continuous and <span class="math inline">\(\epsilon_i  \neq  0\)</span>. For each drawing, estimate by eye the values of <span class="math inline">\(b_0\)</span>, and <span class="math inline">\(b_1\)</span>.</p>
<ol type="a">
<li><span class="math inline">\(y_i = b_0 + b_1 x_i + \epsilon_i\)</span></li>
<li><span class="math inline">\(y_i = b_1 x_i + \epsilon_i\)</span></li>
<li><span class="math inline">\(y_i = b_0 + \epsilon_i\)</span></li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>8E6.</strong> Below are two scattergrams with a non-parametric smoothing function (<code>lowess()</code>). For each scatterplot, do you think a linear regression model would be appropriate? Please motivate.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">124</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Left</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">400</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="sc">-</span> <span class="fl">0.4</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">40</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">300</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">400</span>))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(y <span class="sc">~</span> x), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Right</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">400</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="sc">-</span> <span class="fl">0.4</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fl">0.002</span><span class="sc">*</span>(x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">300</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">400</span>))</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(y <span class="sc">~</span> x), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-stat25_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="medium" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medium">Medium</h3>
<div class="practice">
<p><strong>8M1.</strong> Below is the output from a regression analysis in R, estimating the relationship between reaction time (rt, in milliseconds) on a test and hours of sleep last night (ranging from 3 to 10 hours).</p>
<ol type="a">
<li><p>How many observations were there in this data set?</p></li>
<li><p>What function in R was used to do the regression analysis?</p></li>
<li><p>Draw a scattergram with the fitted line and some hypothetical data that appears consistent with the analysis output.</p></li>
</ol>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>sleep <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">3</span>, <span class="dv">9</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>rt <span class="ot">&lt;-</span> <span class="dv">400</span> <span class="sc">-</span> <span class="dv">20</span><span class="sc">*</span>sleep <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">30</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>fit8m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(rt <span class="sc">~</span> sleep)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit8m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rt ~ sleep)

Residuals:
    Min      1Q  Median      3Q     Max 
-56.925 -26.438  -1.428  20.938  72.771 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   422.28      35.96   11.74  2.7e-08 ***
sleep         -22.22       5.42   -4.10  0.00125 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 35.26 on 13 degrees of freedom
Multiple R-squared:  0.5639,    Adjusted R-squared:  0.5304 
F-statistic: 16.81 on 1 and 13 DF,  p-value: 0.001253</code></pre>
</div>
</div>
<p><br></p>
<div class="practice">
<p><strong>8M2.</strong> Below are the 95% confidence intervals for the model in 8M1. In one sentence, describe the effect of sleep on reaction time (assuming a causal relationship), referencing both the point estimate (given above) and the interval estimate (below), and rounding the estimate to a reasonable level of precision. Ensure your phrasing aligns with the recommendations of <span class="citation" data-cites="Amrhein2019">Amrhein et al. (<a href="references.html#ref-Amrhein2019" role="doc-biblioref">2019</a>)</span>.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit8m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                2.5 %   97.5 %
(Intercept) 344.59947 499.9547
sleep       -33.92954 -10.5131</code></pre>
</div>
</div>
<p><br></p>
<div class="practice">
<p><strong>8M3.</strong> Draw by hand scatter grams illustrating (made up) data and regression lines for these linear models. Assume <span class="math inline">\(D\)</span> to be an indicator variable coded {0, 1} and <span class="math inline">\(\epsilon_i  \neq  0\)</span>. For each drawing, estimate by eye the values of <span class="math inline">\(b_0\)</span>, and <span class="math inline">\(b_1\)</span>.</p>
<ol type="a">
<li><span class="math inline">\(y_i = b_0 + b_1 D_i + \epsilon_i\)</span></li>
<li><span class="math inline">\(y_i = b_1 D_i + \epsilon_i\)</span></li>
<li><span class="math inline">\(y_i = b_0 + \epsilon_i\)</span></li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>8M4.</strong> Assume that you recoded <span class="math inline">\(D\)</span> in 8M3, to have values {-1, 1}. What estimates would you then have for <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> in each of your drawings.</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>8M5.</strong> Gelman et al.&nbsp;talks about <em>descriptive</em>, <em>predictive</em> and <em>causal</em> interpretation of regression coefficients (page 85). Explain in your own words with reference to a model of well-being as a function of physical activity.</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>8M6.</strong> “Your outcome variable does not seem to be normally distributed, so linear regression would be inappropriate.” What’s wrong with this argument?</p>
</div>
<p><br></p>
<p>::: <strong>8M7.</strong> Revisit the simulation of mid-term and final exam scores.</p>
<ol type="a">
<li>Find out what happens with the regression equation if we assume error-free midterm scores.</li>
<li>Find out what happens with the regression equation as you make the errors of midterm and final scores smaller or larger. :::</li>
</ol>
<p><br></p>
<div class="practice">
<p><strong>8M8.</strong> Rerun the fake-data simulation above from Gelman et al.&nbsp;(p.82), but increase the number of observations for each of the 20 x-values. Approximately how many observations per x-value would you need to correctly estimate (within 2 decimals) the true slope parameter most of the time?</p>
</div>
<p><br></p>
</section>
<section id="hard" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="hard">Hard</h3>
<div class="practice">
<p><strong>8H1.</strong></p>
<p>Relate the regression assumptions of <em>linearity</em>, <em>normality</em> and <em>homoscedasticity</em> to the model notation:</p>
<p><span class="math inline">\(y_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = b_0 + b_1x_i\)</span>.</p>
<p><br>
</p>
<p><font size="2.5"></font></p><font size="2.5">
<p>Follow up questions for the advanced student (this will not be on the exam!)</p>
<ol type="a">
<li><p>Sometimes, <span class="math inline">\(ind\)</span> is added to the first line: <span class="math inline">\(y_i \overset{\text{ind}}{\sim} Normal(\mu_i, \sigma)\)</span>, &nbsp;why?</p></li>
<li><p>And why not: <span class="math inline">\(y_i \overset{\text{iid}}{\sim} Normal(\mu_i, \sigma)\)</span>?</p></li>
</ol>
</font><p><font size="2.5"></font></p>
</div>
<p><br></p>
<div class="practice">
<p><strong>8H2.</strong> Go back to your simulation in 8M8.</p>
<ol type="a">
<li>Did the number of observations needed to recover the slope parameter suffice for the intercept? If not, why?</li>
<li>What happen if you “restrict the range” of x to between 10 and 20? Try it out, and discuss the result.</li>
<li>Would it help to rerun the simulation in (b) but with <span class="math inline">\(X\)</span> centered around its mean? Try it out, and discuss the result.</li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>8H3.</strong> Run a bivariate regression on some data (simulated or real) using <code>stan_glm()</code>, plot the data in a scattergram with a set of regression lines from the posterior distribution (see examples above and in Gelman et al, e.g., their Fig. 9.2)</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>8H4.</strong></p>
<ol type="a">
<li><p>From 8H3,plot the posterior for the “standardized” slope <span class="math inline">\(\frac{b_1}{\sigma}\)</span>, and report median posterior with 90 % compatibility interval.</p></li>
<li><p>How does <span class="math inline">\(\frac{b_1}{\sigma}\)</span> relate to Cohen’s d?</p></li>
</ol>
</div>
</section>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">(Session Info)</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.2 (2024-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 26100)

Matrix products: default


locale:
[1] LC_COLLATE=Swedish_Sweden.utf8  LC_CTYPE=Swedish_Sweden.utf8   
[3] LC_MONETARY=Swedish_Sweden.utf8 LC_NUMERIC=C                   
[5] LC_TIME=Swedish_Sweden.utf8    

time zone: Europe/Stockholm
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rstanarm_2.32.1 Rcpp_1.0.14    

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1     dplyr_1.1.4          farver_2.1.2        
 [4] loo_2.8.0            fastmap_1.2.0        tensorA_0.36.2.1    
 [7] shinystan_2.6.0      promises_1.3.3       shinyjs_2.1.0       
[10] digest_0.6.37        mime_0.13            lifecycle_1.0.4     
[13] StanHeaders_2.32.10  survival_3.7-0       magrittr_2.0.3      
[16] posterior_1.6.1      compiler_4.4.2       rlang_1.1.6         
[19] tools_4.4.2          igraph_2.1.4         yaml_2.3.10         
[22] knitr_1.50           htmlwidgets_1.6.4    pkgbuild_1.4.8      
[25] curl_6.4.0           plyr_1.8.9           RColorBrewer_1.1-3  
[28] dygraphs_1.1.1.6     abind_1.4-8          miniUI_0.1.2        
[31] grid_4.4.2           stats4_4.4.2         xts_0.14.1          
[34] xtable_1.8-4         inline_0.3.21        ggplot2_3.5.2       
[37] scales_1.4.0         gtools_3.9.5         MASS_7.3-61         
[40] cli_3.6.5            rmarkdown_2.29       reformulas_0.4.1    
[43] generics_0.1.4       RcppParallel_5.1.10  rstudioapi_0.17.1   
[46] reshape2_1.4.4       minqa_1.2.8          rstan_2.32.7        
[49] stringr_1.5.1        shinythemes_1.2.0    splines_4.4.2       
[52] bayesplot_1.13.0     parallel_4.4.2       matrixStats_1.5.0   
[55] base64enc_0.1-3      vctrs_0.6.5          V8_6.0.4            
[58] boot_1.3-31          Matrix_1.7-1         jsonlite_2.0.0      
[61] crosstalk_1.2.1      glue_1.8.0           nloptr_2.2.1        
[64] codetools_0.2-20     distributional_0.5.0 DT_0.33             
[67] stringi_1.8.7        gtable_0.3.6         later_1.4.2         
[70] QuickJSR_1.8.0       lme4_1.1-37          tibble_3.3.0        
[73] colourpicker_1.3.0   pillar_1.10.2        htmltools_0.5.8.1   
[76] R6_2.6.1             Rdpack_2.6.4         evaluate_1.0.3      
[79] shiny_1.11.1         lattice_0.22-6       markdown_2.0        
[82] rbibutils_2.3        backports_1.5.0      threejs_0.3.4       
[85] httpuv_1.6.16        rstantools_2.4.0     gridExtra_2.3       
[88] nlme_3.1-166         checkmate_2.3.2      xfun_0.52           
[91] zoo_1.8-14           pkgconfig_2.0.3     </code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Amrhein2019" class="csl-entry" role="listitem">
Amrhein, V., Greenland, S., &amp; McShane, B. (2019). Retire statisticial significance. <em>Nature</em>, <em>567</em>, 305–307.
</div>
<div id="ref-box1979robustness" class="csl-entry" role="listitem">
Box, G. E. (1979). Robustness in the strategy of scientific model building. In <em>Robustness in statistics</em> (pp. 201–236). Elsevier.
</div>
<div id="ref-gelman2020regression" class="csl-entry" role="listitem">
Gelman, A., Hill, J., &amp; Vehtari, A. (2021). <em>Regression and other stories</em>. Cambridge University Press.
</div>
<div id="ref-howell2012statistical" class="csl-entry" role="listitem">
Howell, D. C. (2012). <em>Statistical methods for psychology</em>. Cengage Learning.
</div>
<div id="ref-McElreath2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: A bayesian course with examples in r and stan</em>. Chapman; Hall/CRC.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07-method25.html" class="pagination-link" aria-label="M: Within-participant Experiments">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">M: Within-participant Experiments</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-method25.html" class="pagination-link" aria-label="M: Randomized Experiments">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">M: Randomized Experiments</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>