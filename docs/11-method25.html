<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; M: Broken Experiments and Quasi-experiments – RMS notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-stat25.html" rel="next">
<link href="./10-stat25.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="mnstyle.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-method25.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">M: Broken Experiments and Quasi-experiments</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">RMS notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">M: Research Questions and Claims</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">S: Data Management and Screening</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">M: Tools for Thinking About Causality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">S: Descriptive Statistics and Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">M: Measurement and Data Quality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">S: Point Estimates and Their Uncertainty</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">M: Within-participant Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">S: Linear Regression: Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">M: Randomized Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">S: Linear Regression: Single Predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-method25.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">M: Broken Experiments and Quasi-experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">S: Linear Regression: Multiple Predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">M: Observational studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">S: Linear Regression: Non-linear Transformations and Interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">M: Fallacies and paradoxes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">S: Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#topics" id="toc-topics" class="nav-link active" data-scroll-target="#topics">Topics</a></li>
  <li><a href="#randomized-experiment-how-can-i-loose" id="toc-randomized-experiment-how-can-i-loose" class="nav-link" data-scroll-target="#randomized-experiment-how-can-i-loose"><span class="header-section-number">11.1</span> Randomized experiment: How can I loose?</a></li>
  <li><a href="#non-compliance" id="toc-non-compliance" class="nav-link" data-scroll-target="#non-compliance"><span class="header-section-number">11.2</span> Non-compliance</a></li>
  <li><a href="#analytic-approaches-to-non-compliance" id="toc-analytic-approaches-to-non-compliance" class="nav-link" data-scroll-target="#analytic-approaches-to-non-compliance"><span class="header-section-number">11.3</span> Analytic approaches to non-compliance</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">11.4</span> Missing data</a>
  <ul class="collapse">
  <li><a href="#simple-simulation-of-how-missing-data-may-introduce-bias" id="toc-simple-simulation-of-how-missing-data-may-introduce-bias" class="nav-link" data-scroll-target="#simple-simulation-of-how-missing-data-may-introduce-bias">Simple simulation of how missing data may introduce bias</a></li>
  <li><a href="#survivorship-bias" id="toc-survivorship-bias" class="nav-link" data-scroll-target="#survivorship-bias">Survivorship bias</a></li>
  </ul></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice">Practice</a>
  <ul class="collapse">
  <li><a href="#easy" id="toc-easy" class="nav-link" data-scroll-target="#easy">Easy</a></li>
  <li><a href="#medium" id="toc-medium" class="nav-link" data-scroll-target="#medium">Medium</a></li>
  <li><a href="#hard" id="toc-hard" class="nav-link" data-scroll-target="#hard">Hard</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">(Session Info)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">M: Broken Experiments and Quasi-experiments</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Load R-libraries</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty) <span class="co"># R implementation of http://www.dagitty.net</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dagitty' was built under R version 4.4.3</code></pre>
</div>
</div>
<section id="topics" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="topics">Topics</h2>
<div class="concepts">
<ul>
<li><strong>Non-compliance</strong> and <strong>missing data</strong>: Why they may introduce bias in randomized experiments (DAGs are helpful to illustrate)</li>
<li><strong>Complier types</strong>
<ul>
<li>Compliers</li>
<li>Always takers</li>
<li>Never takers</li>
<li>Defiers</li>
</ul></li>
<li><strong>Broken experiments: Analytic approaches</strong>.
<ul>
<li>Non-compliance
<ul>
<li>As treated (AT) analysis</li>
<li>Per protocol (PP) analysis</li>
<li>Intention to treat (ITT) analysis</li>
<li>Treatment effect bounding</li>
</ul></li>
<li>Missing data
<ul>
<li>Complete cases analysis. Understand risk of bias.</li>
<li>Last observation carried forward. Understand risk of bias.</li>
<li>Mean or regression based imputation of single values. Understand risk of bias.</li>
<li>(Multiple imputation: a better alternative but not covered in this course)</li>
</ul></li>
</ul></li>
</ul>
<p>Theoretical articles to read:</p>
<ul>
<li><span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, chapter 18, sections 18.3 - 18.6. Understand SATE and PATE, and tables 18.3-5. (For the interested reader, Chapter 17 of Gelman et al’s book has a nice discussion of missing data, however, this chapter is not part of the course.)</li>
<li><span class="citation" data-cites="sagarin2014treatment">Sagarin et al. (<a href="references.html#ref-sagarin2014treatment" role="doc-biblioref">2014</a>)</span>, Focus on: ITT, AT and PP analysis (pp.&nbsp;317 320, 327 328), and the four patterns of compliance (p.&nbsp;321).</li>
<li><span class="citation" data-cites="rohrer2018thinking">Rohrer (<a href="references.html#ref-rohrer2018thinking" role="doc-biblioref">2018</a>)</span> is an excellent introduction to DAGs.</li>
</ul>
</div>
<p><br></p>
</section>
<section id="randomized-experiment-how-can-i-loose" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="randomized-experiment-how-can-i-loose"><span class="header-section-number">11.1</span> Randomized experiment: How can I loose?</h2>
<p>The randomized experiment is often labeled the “Gold standard” of causal inference. A bit undeservedly if you ask me:</p>
<ul>
<li>Single-unit causal effects still unknown. Remember: SATE (or PATE) close to zero does not imply absence of single-unit causal effects; moderate or small SATE (or PATE) consistent with substantial single-unit causal effect. Single-unit causal effects can only be inferred given strong assumptions. For example, assumptions about normally distributed single-unit causal effects would imply that the average causal effect is representative of the typical individual, or the assumption of constant treatment effect (<span class="citation" data-cites="west2010campbell">West &amp; Thoemmes (<a href="references.html#ref-west2010campbell" role="doc-biblioref">2010</a>)</span>, p.&nbsp;23) would imply that the average causal effect is representative of every individual (unrealistic for most behavioral science phenomena, people react differently to stimuli and treatments).</li>
<li>Non-compliance may introduce systematic error (as discussed below), and internal validity issues, as well as issues with external validity (results generalizes only to compliers).</li>
<li>Drop out may introduce systematic error (as discussed below), and internal validity issues, as well as issues with external validity (results generalizes only to non-drop outs).</li>
<li>Construct validity issues: What was the mechanism of the observed effect? Threats include Placebo and Hawthorne effects (e.g., <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, p.&nbsp;354).</li>
<li>Randomization error (remedy: large n). May lead to discrepancy between SATE and prima-facie estimate, due to randomization errors and thereby issues with internal validity.</li>
<li>Sampling error (remedy: large n). May lead to discrepancy between SATE and PATE, due to sampling error and thereby issues with external validity.</li>
</ul>
<p>To be fair, some of the above applies also to within-subject experiments, including<br>
Single-N designs (my “Gold standard”).</p>
<p><br></p>
<p>Below I will use Directed Acyclical Graphs (DAGs) to illustrate how confounding may cause problems even in large randomized experiments with non-compliance or attrition.</p>
<p><br></p>
</section>
<section id="non-compliance" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="non-compliance"><span class="header-section-number">11.2</span> Non-compliance</h2>
<p>Problem: Confounding by unmeasured variable causing both treatment compliance and outcome.</p>
<p><br></p>
<p><em>Randomized experiment</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty) <span class="co"># R version of http://www.dagitty.net</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>randomized_exp <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">"dag {</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">   Random -&gt; Treatment</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">   Treatment -&gt; Outcome</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">   Z -&gt; Outcome</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(randomized_exp) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="at">Random =</span> <span class="dv">1</span>, <span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">Z =</span> <span class="fl">2.5</span>, <span class="at">Outcome =</span> <span class="dv">3</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Random =</span> <span class="dv">2</span>, <span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">Z =</span> <span class="fl">1.5</span>, <span class="at">Outcome =</span> <span class="dv">2</span>))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(randomized_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11-method25_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><em>Broken randomized experiment (treatment has a causal effect)</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>broken_exp <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">"dag {</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">   Random -&gt; Treatment</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">   Treatment -&gt; Outcome</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">   Z -&gt; Treatment -&gt; Outcome</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">   Z -&gt; Outcome</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(broken_exp) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="at">Random =</span> <span class="dv">1</span>, <span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">Z =</span> <span class="fl">2.5</span>, <span class="at">Outcome =</span> <span class="dv">3</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Random =</span> <span class="dv">2</span>, <span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">Z =</span> <span class="fl">1.5</span>, <span class="at">Outcome =</span> <span class="dv">2</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(broken_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11-method25_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><em>Broken randomized experiment (treatment has no causal effect)</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>broken_exp2 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">"dag {</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">   Random -&gt; Treatment</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">   Z -&gt; Treatment</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">   Z -&gt; Outcome</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(broken_exp2) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="at">Random =</span> <span class="dv">1</span>, <span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">Z =</span> <span class="fl">2.5</span>, <span class="at">Outcome =</span> <span class="dv">3</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Random =</span> <span class="dv">2</span>, <span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">Z =</span> <span class="fl">1.5</span>, <span class="at">Outcome =</span> <span class="dv">2</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(broken_exp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11-method25_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p><br><br></p>
<p>The problem is that <span class="math inline">\(Z\)</span> in the broken experiment scenarios may introduce bias. One way to think about this is offered by the potential outcome perspective, from which we may define four “causal types”. Think of an experiment in which kids are randomly assigned to “music lesson” (treatment) or “no music lessons” (control), cf. <span class="citation" data-cites="schellenberg2004music">Schellenberg (<a href="references.html#ref-schellenberg2004music" role="doc-biblioref">2004</a>)</span>.</p>
<ul>
<li><strong>Compliers</strong> will do as we say: if assigned to “music lesson” they will take music lessons, if assigned to “no music lessons” they will not take music lessons.</li>
<li><strong>Always-takers</strong> will always take the treatment: if assigned to “music lesson” they will take music lessons, if assigned to “no music lessons” they will nevertheless take music lessons.</li>
<li><strong>Never-takers</strong> will never take the treatment: if assigned to “music lesson” they will not take music lessons, and same if they were assigned to “no music lessons”.</li>
<li><strong>Defiers</strong> will never do as we say: if assigned to “music lesson” they will not take music lessons, if assigned to “no music lessons” they will take music lessons.</li>
</ul>
<p>We usually assume that there are no <em>defiers</em>. Sometimes it is also possible to assume no <em>always takers</em>, if, for instance, we are administrating the music lessons we may make sure to only let in those who were assigned to treatment (but you never know, maybe an always-taker would buy similar music lessons from somewhere else).</p>
<p>It might be that the possible confounder <span class="math inline">\(Z\)</span> may lead to unbalanced groups, for instance, <span class="math inline">\(Z\)</span> might be socioeconomic status (SES), and maybe there are more <em>never-takers</em> among people with low compared to high SES. This may lead to lower SES among the non-treated than the treated, and this may look as an effect if treatment on the outcome. In <span class="citation" data-cites="schellenberg2004music">Schellenberg (<a href="references.html#ref-schellenberg2004music" role="doc-biblioref">2004</a>)</span>, the outcome was IQ scores, a variable that probably is related to SES.</p>
<p><br></p>
</section>
<section id="analytic-approaches-to-non-compliance" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="analytic-approaches-to-non-compliance"><span class="header-section-number">11.3</span> Analytic approaches to non-compliance</h2>
<p><span class="citation" data-cites="sagarin2014treatment">Sagarin et al. (<a href="references.html#ref-sagarin2014treatment" role="doc-biblioref">2014</a>)</span></p>
<ol type="1">
<li>Intention-to-treat</li>
<li>As-treated</li>
<li>Per-protocol</li>
<li>Instrumental variable (not covered in this course)</li>
<li>Dose-response estimation (not covered in this course)</li>
<li>Propensity score analysis (not covered in this course)</li>
<li>Treatment effect bounding (briefly exemplified below)</li>
</ol>
<p><br><br></p>
<p><strong>Simple example:</strong></p>
<p>Randomized experiment, 500 to Control group (do nothing), 500 to Experimental group (participate in training program).<br>
Non-compliance: 100 participants in the treatment group did not take the treatment, and those were at high risk of mortality for other reasons (confounder Z).</p>
<p><strong>Data</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Survived</th>
<th>Dead</th>
<th><em>Row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Control</strong></td>
<td>450</td>
<td>50</td>
<td><em>500</em></td>
</tr>
<tr class="even">
<td><strong>Treatment</strong></td>
<td>380</td>
<td>20</td>
<td><em>400</em></td>
</tr>
<tr class="odd">
<td><strong>Control non-complier</strong></td>
<td>80</td>
<td>20</td>
<td><em>100</em> (100 non-compliers, assigned to treatment)</td>
</tr>
<tr class="even">
<td><em>Column sum</em></td>
<td><em>910</em></td>
<td><em>90</em></td>
<td><strong>1000</strong></td>
</tr>
</tbody>
</table>
<p><br></p>
<p><em>Intention-to-treat</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Survived</th>
<th>Dead</th>
<th><em>Row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Control</strong></td>
<td>450</td>
<td>50</td>
<td><em>500</em></td>
</tr>
<tr class="even">
<td><strong>Treatment</strong></td>
<td>380 + 80</td>
<td>20 + 20</td>
<td><em>500</em> (400 + 100 non-compliers)</td>
</tr>
<tr class="odd">
<td><em>Column sum</em></td>
<td><em>910</em></td>
<td><em>90</em></td>
<td><strong>1000</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative risk and risk difference Control vs. Treated</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>RD <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RD =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">-</span> (<span class="dv">40</span><span class="sc">/</span><span class="dv">500</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>RR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RR =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">/</span> (<span class="dv">40</span><span class="sc">/</span><span class="dv">500</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(RR, RD), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  RR   RD 
1.25 0.02 </code></pre>
</div>
</div>
<p><br></p>
<p><em>As-treated analysis: Risk mortality in Control group vs.&nbsp;Treatment group</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Survived</th>
<th>Dead</th>
<th><em>Row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Control</strong></td>
<td>450 + 80</td>
<td>50 + 20</td>
<td><em>600</em> (500 + 100 non-compliers)</td>
</tr>
<tr class="even">
<td><strong>Treatment</strong></td>
<td>380</td>
<td>20</td>
<td><em>400</em></td>
</tr>
<tr class="odd">
<td><em>Column sum</em></td>
<td><em>910</em></td>
<td><em>90</em></td>
<td><strong>1000</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative risk and risk difference Control vs. Treated</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>RD <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RD =</span> (<span class="dv">70</span><span class="sc">/</span><span class="dv">600</span>) <span class="sc">-</span> (<span class="dv">20</span><span class="sc">/</span><span class="dv">400</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>RR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RR =</span> (<span class="dv">70</span><span class="sc">/</span><span class="dv">600</span>) <span class="sc">/</span> (<span class="dv">20</span><span class="sc">/</span><span class="dv">400</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(RR, RD), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   RR    RD 
2.333 0.067 </code></pre>
</div>
</div>
<p><em>Per-protocol analysis: Risk mortality in Control group vs.&nbsp;Treatment group</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Survived</th>
<th>Dead</th>
<th><em>Row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Control</strong></td>
<td>450</td>
<td>50</td>
<td><em>500</em></td>
</tr>
<tr class="even">
<td><strong>Treatment</strong></td>
<td>380</td>
<td>20</td>
<td><em>400</em></td>
</tr>
<tr class="odd">
<td><em>Column sum</em></td>
<td><em>830</em></td>
<td><em>70</em></td>
<td><strong>900</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative risk and risk difference Control vs. Treated</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>RD <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RD =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">-</span> (<span class="dv">20</span><span class="sc">/</span><span class="dv">400</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>RR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RR =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">/</span> (<span class="dv">20</span><span class="sc">/</span><span class="dv">400</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(RR, RD), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  RR   RD 
2.00 0.05 </code></pre>
</div>
</div>
<p><br></p>
<p><strong>Hypotetical Data 1 (best case)</strong><br>
Assuming that all non-compliers (never-takers) would have survived had they taken the treatment</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Survived</th>
<th>Dead</th>
<th><em>Row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Control</strong></td>
<td>450</td>
<td>50</td>
<td><em>500</em></td>
</tr>
<tr class="even">
<td><strong>Treatment</strong></td>
<td>380 + 100</td>
<td>20</td>
<td><em>500</em> (400 + 100 surviving never-takers)</td>
</tr>
<tr class="odd">
<td><em>Column sum</em></td>
<td><em>930</em></td>
<td><em>70</em></td>
<td><strong>1000</strong></td>
</tr>
</tbody>
</table>
<p><em>Upper bound: Risk mortality in Control group vs.&nbsp;Treatment group</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative risk and risk difference Control vs. Treated</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>RDhi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RDhi =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">-</span> (<span class="dv">20</span><span class="sc">/</span><span class="dv">500</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>RRhi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RRhi =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">/</span> (<span class="dv">20</span><span class="sc">/</span><span class="dv">500</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(RRhi, RDhi), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>RRhi RDhi 
2.50 0.06 </code></pre>
</div>
</div>
<p><strong>Hypotetical Data 2 (worst case)</strong><br>
Assuming that all never-takers would have died had they taken the treatment</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Survived</th>
<th>Dead</th>
<th><em>Row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Control</strong></td>
<td>450</td>
<td>50</td>
<td><em>500</em></td>
</tr>
<tr class="even">
<td><strong>Treatment</strong></td>
<td>380</td>
<td>20 + 100</td>
<td><em>500</em> (400 + 100 non-surviving never takers)</td>
</tr>
<tr class="odd">
<td><em>Column sum</em></td>
<td><em>830</em></td>
<td><em>170</em></td>
<td><strong>1000</strong></td>
</tr>
</tbody>
</table>
<p><em>Lower bound: Risk mortality in Control group vs.&nbsp;Treatment group</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative risk and risk difference Control vs. Treated</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>RDlo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RDlo =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">-</span> (<span class="dv">120</span><span class="sc">/</span><span class="dv">500</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>RRlo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">RRlo =</span> (<span class="dv">50</span><span class="sc">/</span><span class="dv">500</span>) <span class="sc">/</span> (<span class="dv">120</span><span class="sc">/</span><span class="dv">500</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(RRlo, RDlo), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  RRlo   RDlo 
 0.417 -0.140 </code></pre>
</div>
</div>
<p><br><br></p>
</section>
<section id="missing-data" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="missing-data"><span class="header-section-number">11.4</span> Missing data</h2>
<p>Missing data may lead to similar problem as non-compliance, through adjusting for a collider variable and thereby introducing bias (often called <em>attrition bias</em>).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11-method25_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Classification of missing data:</p>
<ul>
<li><strong>Missingness completely at random</strong> (MCAR). The best scenario, probability of missingness is the same for all study units regardless of background variables. No bias related to missingness.</li>
<li><strong>Missingness at random</strong> (MAR). The second best scenario: Probability of missingness depend only on observed variables, missing cases can be excluded if these observed variables are adjusted for.</li>
<li><strong>Missingness not at random</strong> (MNAR). The worst scenario. Missingness related to unobserved variables, potentially inducing bias in causal effect estimates.</li>
</ul>
<p><br></p>
<p>Common methods for dealing with missing data in randomized experiments (and elsewhere):</p>
<ul>
<li><strong>Complete cases</strong>. Analyse only cases for which there is no missing data on the outcome variable. If the experiment involve measures before and after treatment, this would require data on both. May lead to bias if missingness is not random, but is related to unmeasured confounders and treatment.</li>
<li><strong>Last value carried forward</strong>. A common method, where missing data after treatment (“lost to follow up”) is replaced (imputed) with the before treatment measure. May lead to bias if missingness is not random, but related to unmeasured confounders or to treatment.</li>
<li><strong>Mean imputation</strong>. Imputation of the mean of of the observed values for variable with missing data. May lead to an underestimation of the variable’s variance.</li>
<li><strong>Predicted value</strong> Impute predicted value based on a regression analysis of participants with full data sets. Similar problem as mean imputation.</li>
<li>(<strong>Advanced methods</strong>, e.g., multiple imputation. not covered by this course. Generally viewed as superior to the above methods)</li>
</ul>
<p>For more on missing data, see <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span> Chapter 17, sections 3-6 (discussed further in the Statistics course).</p>
<p><br></p>
<section id="simple-simulation-of-how-missing-data-may-introduce-bias" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="simple-simulation-of-how-missing-data-may-introduce-bias">Simple simulation of how missing data may introduce bias</h3>
<p>This DAG show a scenario with no treatment effect and drop out related to a covariate Z, leading to attrition bias.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11-method25_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Here a simulation of this scenario.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate treatment and covariate variables</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">400</span>  <span class="co"># Total sample size</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>rand <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)  <span class="co"># Randomization</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>treat <span class="ot">&lt;-</span> rand  <span class="co"># In this simulation there are only compliers</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)  <span class="co"># Standardized covariate, normal distribution, mean = 0, sd = 1</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate drop out and dependent variable (y) </span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Everyone in treatment group low on z drops out</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>dropout <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> (treat <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> z <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">1</span>) </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># True data: including dropouts. Outcome related to z, but not to treatment</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>ytrue <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> z   </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed data: Dropouts = NA</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>yobs <span class="ot">&lt;-</span> ytrue</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>yobs[dropout <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Put data in data frame</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rand, treat, z, dropout, ytrue, yobs)  <span class="co"># Make data frame</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      rand           treat             z                dropout     
 Min.   :0.000   Min.   :0.000   Min.   :-2.588446   Min.   :0.000  
 1st Qu.:0.000   1st Qu.:0.000   1st Qu.:-0.711258   1st Qu.:0.000  
 Median :1.000   Median :1.000   Median : 0.003622   Median :0.000  
 Mean   :0.515   Mean   :0.515   Mean   :-0.023033   Mean   :0.085  
 3rd Qu.:1.000   3rd Qu.:1.000   3rd Qu.: 0.655788   3rd Qu.:0.000  
 Max.   :1.000   Max.   :1.000   Max.   : 3.061137   Max.   :1.000  
                                                                    
     ytrue               yobs       
 Min.   :-9.12489   Min.   :-7.010  
 1st Qu.:-2.13428   1st Qu.:-1.401  
 Median : 0.03864   Median : 0.388  
 Mean   :-0.08352   Mean   : 0.359  
 3rd Qu.: 2.00790   3rd Qu.: 2.235  
 Max.   :10.13607   Max.   :10.136  
                    NA's   :34      </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">treatment =</span> d<span class="sc">$</span>treat, <span class="at">dropout =</span> d<span class="sc">$</span>dropout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         dropout
treatment   0   1
        0 194   0
        1 172  34</code></pre>
</div>
</div>
<p><br></p>
<p>Analyze “true data”, that is, assuming we know the values for the drop outs. No suggested treatment effect, as expected given our simulation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Analyze "true" data, i.e. assuming we know values for drop outs</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>m_true <span class="ot">&lt;-</span> <span class="fu">lm</span>(ytrue <span class="sc">~</span> treat, <span class="at">data =</span> d)  <span class="co"># or t.test(g$y ~ g$treat, var.equal = TRUE)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>m_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ytrue ~ treat, data = d)

Coefficients:
(Intercept)        treat  
   -0.07720     -0.01226  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m_true)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept) -0.5144118 0.3600022
treat       -0.6214896 0.5969766</code></pre>
</div>
</div>
<p><br></p>
<p>Analyze observed data, drop outs not included. Strong treatment effect suggested, this because we unintentionally controlled for “dropout” (analyses conditional on dropout = 0) and thereby introduced bias through covariate Z (so called “collider bias”)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Analyze observed data, drop outs excluded</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">treatment =</span> d<span class="sc">$</span>treat[d<span class="sc">$</span>dropout <span class="sc">==</span> <span class="dv">0</span>], <span class="at">dropout =</span> d<span class="sc">$</span>dropout[d<span class="sc">$</span>dropout <span class="sc">==</span> <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         dropout
treatment   0
        0 194
        1 172</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>m_observed <span class="ot">&lt;-</span> <span class="fu">lm</span>(yobs <span class="sc">~</span> treat, <span class="at">data =</span> d)  <span class="co"># lm() excludes rows with NA</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>m_observed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = yobs ~ treat, data = d)

Coefficients:
(Intercept)        treat  
    -0.0772       0.9283  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m_observed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept) -0.4705239 0.3161144
treat        0.3545671 1.5020637</code></pre>
</div>
</div>
<p><br></p>
<p>In this simple scenario, the bias is removed if we control for the covariate Z, for example, by adding it as a covariate in the regression analyses</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Adjusting for the covariate eliminates bias </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>m_observed2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yobs <span class="sc">~</span> treat <span class="sc">+</span> z, <span class="at">data =</span> d)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>m_observed2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = yobs ~ treat + z, data = d)

Coefficients:
(Intercept)        treat            z  
   0.008107    -0.007058     2.944561  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m_observed2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept) -0.1349844 0.1511988
treat       -0.2190974 0.2049811
z            2.8260857 3.0630357</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="survivorship-bias" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="survivorship-bias">Survivorship bias</h3>
<p>The attrition bias discussed above is an example of survivorship bias, a specific form of selection bias that occurs when only the “survivors” or successful outcomes are considered, while failures or non-survivors are excluded from analysis.</p>
<p>A classic example involves the analysis of aircraft damage during World War II. Initially, it was suggested to reinforce the areas of returning planes that showed the most damage. However, statistician Abraham Wald proposed reinforcing the vital areas that showed little to no damage. He recognized that planes with damage to these critical areas had not returned.</p>
<p>Another example is the analysis of successful musicians. Suppose a study shows that all of them practiced for more than 10,000 hours. It would be incorrect to conclude that “practicing for 10,000+ hours will make you a professional musician,” because the sample excludes those who practiced extensively but did not achieve success. By ignoring the “non-survivors” (those who did not make it despite the effort), the conclusion falsely attributes success solely to the number of practice hours, when other factors may play a role.</p>
<p><br></p>
</section>
</section>
<section id="practice" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="practice">Practice</h2>
<p>The practice problems are labeled Easy (E), Medium (M), and Hard (H), (as in <span class="citation" data-cites="McElreath2020">McElreath (<a href="references.html#ref-McElreath2020" role="doc-biblioref">2020</a>)</span>).</p>
<section id="easy" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="easy">Easy</h3>
<div class="practice">
<p><strong>11E1.</strong><br>
a. Explain with an example and a DAG how <em>missing data</em> may lead to bias of causal effect estimates in randomized experiments.<br>
b. Explain with an example and a DAG how <em>non-compliance</em> may lead to bias of causal effect estimates in randomized experiments.</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>11E2.</strong><br>
Explain why <em>as-treated</em> and <em>per-protocol</em> analysis of data from randomized experiments may be biased in situations with non-compliance, and explain in what way, if any, this problem is avoided using <em>intention-to-treat</em> analysis.</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>11E3.</strong><br>
<em>Treatment effect bounding</em> is an attempt to estimate an interval of possible effect sizes in cases of drop outs or non-compliance in randomized experiments. The general idea can be applied in other contexts: Assume that a course was given a mean rating of 8 on a scale from 1 (disaster) to 10 (excellent); 100 students took the course, but only 70 provided a rating. Calculate an interval of possible mean ratings had all students answered.</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>11E4.</strong> Why might replacing missing data in a variable with its mean value seem like a reasonable approach, and what are the significant drawbacks of this method?</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>11E5.</strong> <em>Fooled by the Winners</em> is a book by David Lockwood (2021, Austin, Texas: Greenleaf Book Group Press).</p>
<ol type="a">
<li><p>Based on the title, what do you think the book might be about?</p></li>
<li><p>Consider the following excerpt from the book: “In every town I have lived in, many restaurants seem to have been around for a long time, in some cases decades. This could lead one to believe that restaurants are a relatively reliable, stable business.” (p.45) Why might this conclusion be flawed?</p></li>
</ol>
</div>
<p><br></p>
</section>
<section id="medium" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medium">Medium</h3>
<div class="practice">
<p><strong>11M1.</strong> <em>Last-value-carried-forward</em> is a common method for imputation of data lost to follow up.</p>
<ol type="a">
<li>Explain how this method may lead to underestimation of the true effect.<br>
</li>
<li>Can it also lead to overestimation?</li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>11M2.</strong> Answer a. and b. from 11M1 but now with regard to <em>intention-to-treat</em> (ITT) analyses.</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>11M3.</strong> Above we defined four types of compliance types. A somewhat similar typology relates to outcomes in a scenario with a binary exposure (e.g., smoking yes/no) and a binary outcome (e.g., lung cancer yes/no): 1. Doomed, 2. Causal, 3. Preventive, 4. Immune.</p>
<ol type="a">
<li>Try to figure out how these types are defined.<br>
</li>
<li>They are always unobserved. Explain.</li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>11M4.</strong> Explain the concepts of missing data mechanisms:</p>
<ul>
<li>Missing Completely at Random (MCAR),</li>
<li>Missing at Random (MAR),</li>
<li>Missing Not at Random (MNAR),</li>
</ul>
<p>using an illustrative example based on an imagined randomized experiment? Include how each mechanism would impact data analysis and interpretation.</p>
</div>
<p><br></p>
</section>
<section id="hard" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="hard">Hard</h3>
<div class="practice">
<p><strong>11H1.</strong> Illustrate with a simulation how non-compliance may bias effect estimates, assume:</p>
<ol type="a">
<li>A substantial proportion always-takers, no never-takers</li>
<li>A substantial proportion never-takers, no always-takers</li>
<li>Substantial proportions always-takers and never-takers</li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>11H2.</strong> Illustrate with a simulation how missing data may or may not bias effect estimates in situations with complete cases analysis and:</p>
<ol type="a">
<li>Missingness completely at random.</li>
<li>Missingness at random.</li>
<li>Missingness not at random.</li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>11H3.</strong> Rerun your simulations from 11H2, but now using one or several methods for data imputation.</p>
</div>
<p><br></p>
</section>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">(Session Info)</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.2 (2024-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 26100)

Matrix products: default


locale:
[1] LC_COLLATE=Swedish_Sweden.utf8  LC_CTYPE=Swedish_Sweden.utf8   
[3] LC_MONETARY=Swedish_Sweden.utf8 LC_NUMERIC=C                   
[5] LC_TIME=Swedish_Sweden.utf8    

time zone: Europe/Stockholm
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] dagitty_0.3-4

loaded via a namespace (and not attached):
 [1] digest_0.6.37     fastmap_1.2.0     xfun_0.52         knitr_1.50       
 [5] htmltools_0.5.8.1 rmarkdown_2.29    cli_3.6.5         compiler_4.4.2   
 [9] boot_1.3-31       rstudioapi_0.17.1 tools_4.4.2       curl_6.4.0       
[13] evaluate_1.0.3    Rcpp_1.0.14       yaml_2.3.10       rlang_1.1.6      
[17] jsonlite_2.0.0    V8_6.0.4          htmlwidgets_1.6.4 MASS_7.3-61      </code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-gelman2020regression" class="csl-entry" role="listitem">
Gelman, A., Hill, J., &amp; Vehtari, A. (2021). <em>Regression and other stories</em>. Cambridge University Press.
</div>
<div id="ref-McElreath2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: A bayesian course with examples in r and stan</em>. Chapman; Hall/CRC.
</div>
<div id="ref-rohrer2018thinking" class="csl-entry" role="listitem">
Rohrer, J. M. (2018). Thinking clearly about correlations and causation: Graphical causal models for observational data. <em>Advances in Methods and Practices in Psychological Science</em>, <em>1</em>(1), 27–42.
</div>
<div id="ref-sagarin2014treatment" class="csl-entry" role="listitem">
Sagarin, B. J., West, S. G., Ratnikov, A., Homan, W. K., Ritchie, T. D., &amp; Hansen, E. J. (2014). Treatment noncompliance in randomized experiments: Statistical approaches and design issues. <em>Psychological Methods</em>, <em>19</em>(3), 317.
</div>
<div id="ref-schellenberg2004music" class="csl-entry" role="listitem">
Schellenberg, E. G. (2004). Music lessons enhance IQ. <em>Psychological Science</em>, <em>15</em>(8), 511–514.
</div>
<div id="ref-west2010campbell" class="csl-entry" role="listitem">
West, S. G., &amp; Thoemmes, F. (2010). Campbell’s and rubin’s perspectives on causal inference. <em>Psychological Methods</em>, <em>15</em>(1), 18.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10-stat25.html" class="pagination-link" aria-label="S: Linear Regression: Single Predictor">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">S: Linear Regression: Single Predictor</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-stat25.html" class="pagination-link" aria-label="S: Linear Regression: Multiple Predictors">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">S: Linear Regression: Multiple Predictors</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>