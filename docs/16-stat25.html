<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>16&nbsp; S: Logistic Regression – RMS notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./15-method25.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="mnstyle.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16-stat25.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">S: Logistic Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">RMS notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">M: Research Questions and Claims</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">S: Data Management and Screening</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">M: Tools for Thinking About Causality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">S: Descriptive Statistics and Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">M: Measurement and Data Quality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">S: Point Estimates and Their Uncertainty</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">M: Within-participant Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">S: Linear Regression: Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">M: Randomized Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">S: Linear Regression: Single Predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">M: Broken Experiments and Quasi-experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">S: Linear Regression: Multiple Predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">M: Observational studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-stat25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">S: Linear Regression: Non-linear Transformations and Interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-method25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">M: Fallacies and paradoxes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-stat25.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">S: Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#topics" id="toc-topics" class="nav-link active" data-scroll-target="#topics">Topics</a></li>
  <li><a href="#relative-and-absolute-risk" id="toc-relative-and-absolute-risk" class="nav-link" data-scroll-target="#relative-and-absolute-risk"><span class="header-section-number">16.1</span> Relative and absolute risk</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">16.2</span> Logistic regression</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-with-just-an-intercept" id="toc-logistic-regression-with-just-an-intercept" class="nav-link" data-scroll-target="#logistic-regression-with-just-an-intercept">Logistic regression with just an intercept</a></li>
  <li><a href="#logistic-regression-with-a-single-binary-predictor" id="toc-logistic-regression-with-a-single-binary-predictor" class="nav-link" data-scroll-target="#logistic-regression-with-a-single-binary-predictor">Logistic regression with a single binary predictor</a></li>
  </ul></li>
  <li><a href="#arsenic-data" id="toc-arsenic-data" class="nav-link" data-scroll-target="#arsenic-data"><span class="header-section-number">16.3</span> Arsenic data</a></li>
  <li><a href="#check-residuals-in-logistic-regression-optional" id="toc-check-residuals-in-logistic-regression-optional" class="nav-link" data-scroll-target="#check-residuals-in-logistic-regression-optional"><span class="header-section-number">16.4</span> Check residuals in logistic regression (optional!)</a></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice">Practice</a>
  <ul class="collapse">
  <li><a href="#easy" id="toc-easy" class="nav-link" data-scroll-target="#easy">Easy</a></li>
  <li><a href="#medium" id="toc-medium" class="nav-link" data-scroll-target="#medium">Medium</a></li>
  <li><a href="#hard" id="toc-hard" class="nav-link" data-scroll-target="#hard">Hard</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">(Session Info)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">S: Logistic Regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Load R-libraries</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the library "rstanarm" to fit Bayesian linear models using the function  </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stan_glm() </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="topics" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="topics">Topics</h2>
<div class="concepts">
<ul>
<li>Relative versus absolute risk
<ul>
<li>Risk</li>
<li>Odds</li>
<li>Risk difference</li>
<li>Relative risk (or risk ratio)</li>
<li>Odds ratio</li>
</ul></li>
<li>Logistic regression.
<ul>
<li>Logistic regression model</li>
<li>Interpretation of coefficients</li>
</ul></li>
</ul>
<p>Readings:<br>
<span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span>, Chapter 13 covers logistic regression.</p>
</div>
<p><br></p>
</section>
<section id="relative-and-absolute-risk" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="relative-and-absolute-risk"><span class="header-section-number">16.1</span> Relative and absolute risk</h2>
<p>Before we go into the details of logistic regression, we need to clarify the meaning of common measures of binary outcomes and contrasts, specifically:</p>
<ul>
<li>Risk (or prevalence, or proportion, or probability),</li>
<li>Odds,</li>
<li>Risk difference,</li>
<li>Relative risk (or risk ratio), and</li>
<li>Odds ratio.</li>
</ul>
<p><br></p>
<p>Relationship probability (“risk”) and odds:</p>
<ul>
<li><span class="math inline">\(odds = \frac{p}{1 - p}\)</span><br>
</li>
<li><span class="math inline">\(p = \frac{odds}{1 + odds}\)</span></li>
</ul>
<p><br></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Group</th>
<th style="text-align: center;">Disease</th>
<th style="text-align: center;">No disease</th>
<th style="text-align: left;"><em>row sum</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">a</td>
<td style="text-align: center;">b</td>
<td style="text-align: left;"><em>a+b</em></td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">c</td>
<td style="text-align: center;">d</td>
<td style="text-align: left;"><em>c+d</em></td>
</tr>
</tbody>
</table>
<p><br></p>
<ul>
<li><strong>Risk</strong>
<ul>
<li><span class="math inline">\(Risk_{group 1} = a/(a+b)\)</span></li>
<li><span class="math inline">\(Risk_{group 0} = c/(c+d)\)</span></li>
</ul></li>
<li><strong>Odds</strong>
<ul>
<li><span class="math inline">\(Odds_{group 1} = Risk_{group 1} / (1 - Risk_{group 1}) = a/b\)</span></li>
<li><span class="math inline">\(Odds_{group 0} = Risk_{group 0} / (1 - Risk_{group 0}) = c/d\)</span></li>
</ul></li>
<li><strong>Risk difference</strong> (RD)
<ul>
<li><span class="math inline">\(RD = Risk_{group 1} - Risk_{group 0} = a/(a+b) - c/(c+d)\)</span>, or</li>
<li><span class="math inline">\(RD = Risk_{group 0} - Risk_{group 1} = c/(c+d) - a/(a+b)\)</span></li>
</ul></li>
<li><strong>Relative risk</strong> (RR)
<ul>
<li><span class="math inline">\(RR = Risk_{group 1} / Risk_{group 0} = \frac{a/(a+b)}{c/(c+d)}\)</span>, or</li>
<li><span class="math inline">\(RR = Risk_{group 0} / Risk_{group 1} = \frac{c/(c+d)}{a/(a+b)}\)</span></li>
</ul></li>
<li><strong>Odds ratio</strong> (OR)
<ul>
<li><span class="math inline">\(OR = Odds_{group 1} / Odds_{group 0} = \frac{a/b}{c/d} = \frac{ad}{bc}\)</span>, or</li>
<li><span class="math inline">\(OR = Odds_{group 0} / Odds_{group 1} = \frac{c/d}{a/b} = \frac{bc}{ad}\)</span></li>
</ul></li>
</ul>
<p><strong>Note</strong>: With low prevalence of disease (low risk), <span class="math inline">\(a\)</span> is much smaller than <span class="math inline">\(b\)</span>, and <span class="math inline">\(c\)</span> is much smaller than <span class="math inline">\(d\)</span>, and OR is similar to RR.</p>
<p><span class="math inline">\(RR = \frac{a/(a+b)}{c/(c+d)} \approx \frac{a/b}{c/d} = OR\)</span>, if <span class="math inline">\(a \ll b, c \ll d\)</span></p>
<p>For large <span class="math inline">\(a\)</span> and <span class="math inline">\(c\)</span>, <span class="math inline">\(OR &gt; RR\)</span></p>
<p><br></p>
<p><br></p>
<p><strong>Randomized controlled trial: Effect of aspirin on the incidence of heart attacks.</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Group</th>
<th style="text-align: center;">Heart attack</th>
<th style="text-align: center;">No heart attack</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Aspirin</td>
<td style="text-align: center;">104</td>
<td style="text-align: center;">10,933</td>
<td style="text-align: left;"><em>11,037</em></td>
</tr>
<tr class="even">
<td style="text-align: left;">Placebo</td>
<td style="text-align: center;">189</td>
<td style="text-align: center;">10,845</td>
<td style="text-align: left;"><em>11,034</em></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;"><em>293</em></td>
<td style="text-align: center;"><em>21,778</em></td>
<td style="text-align: left;"><em>22,071</em></td>
</tr>
</tbody>
</table>
<p><br></p>
<ul>
<li><strong>Risk</strong>
<ul>
<li><span class="math inline">\(Risk_{aspirin} = 104/11037\)</span> = 0.0094</li>
<li><span class="math inline">\(Risk_{placebo} = 189/11034\)</span> = 0.0171</li>
</ul></li>
<li><strong>Odds</strong>
<ul>
<li><span class="math inline">\(Odds_{aspirin} = 104/10933\)</span> = 0.0095</li>
<li><span class="math inline">\(Odds_{placebo} = 189/10845\)</span> = 0.0174</li>
</ul></li>
<li><strong>Risk difference</strong> (RD)
<ul>
<li><span class="math inline">\(RD = Risk_{aspirin} - Risk_{placebo}\)</span> = -0.0077</li>
<li><span class="math inline">\(RD = Risk_{placebo} - Risk_{aspirin}\)</span> = 0.0077</li>
</ul></li>
<li><strong>Relative risk</strong> (RR)
<ul>
<li><span class="math inline">\(RR = Risk_{aspirin} / Risk_{placebo}\)</span> = 0.5501</li>
<li><span class="math inline">\(RR = Risk_{placebo} / Risk_{aspirin}\)</span> = 1.8178</li>
</ul></li>
<li><strong>Odds ratio</strong> (OR)
<ul>
<li><span class="math inline">\(OR = Odds_{aspirin} / Odds_{placebo}\)</span> = 0.5458</li>
<li><span class="math inline">\(OR = Odds_{placebo} / Odds_{aspirin}\)</span> = 1.8321</li>
</ul></li>
</ul>
<p><br></p>
</section>
<section id="logistic-regression" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">16.2</span> Logistic regression</h2>
<p>Logistic regression is used for binary outcome variables, typically coded 0 or 1, such as alive/dead, healthy/sick, successful/unsuccessful, correct/incorrect, etc.</p>
<p>Remember the general form of of the linear model:</p>
<p><span class="math inline">\(y_i \sim Normal(\mu_i, \sigma)\)</span><br>
<span class="math inline">\(\mu_i = b_0 + b_1x_i\)</span></p>
<p>Logistic regression can be defined similarly:</p>
<p><span class="math inline">\(y_i \sim Bernoulli(p_i)\)</span><br>
<span class="math inline">\(p_i = logit^{-1}(b_0 + b_1x_i)\)</span></p>
<p>Or equivalent (and more common):</p>
<p><span class="math inline">\(y_i \sim Bernoulli(p_i)\)</span><br>
<span class="math inline">\(logit(p_i) = b_0 + b_1x_i\)</span></p>
<p>Note that <span class="math inline">\(Bernoulli(p)\)</span> is a special cases of the binomial distribution <span class="math inline">\(Binomial(n, p)\)</span> with <span class="math inline">\(n = 1\)</span>.</p>
<p><br></p>
<p>The estimated parameter <span class="math inline">\(p_i\)</span> is the probability (“risk”) of y = 1 given specific value(s) of the predictor(s) x. The probability <span class="math inline">\(p_i\)</span> is also the mean, as the mean of an indicator variable y is the probability of y = 1. Thus, both the linear and the logistic model predicts the mean value of the outcome variable given a specific value of the predictor. A difference is that the estimated parameter <span class="math inline">\(\mu_i\)</span> in the linear model is also a possible value of a single observation, whereas the estimated parameter <span class="math inline">\(p_i\)</span> in logistic regression is a value that is never seen in a single observation, as these only can take on values of 0 or 1.</p>
<p><br></p>
<p>The logistic model involve a linear model. In theory, a line has no boundaries and can go from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>, whereas a probability (or risk or proportion or prevalence) can only take values between 0 and 1. The way logistic regression deals with this is to make a linear model not of the probability, but of the unbounded log-odds:</p>
<ul>
<li><span class="math inline">\(p\)</span> &nbsp;&nbsp;&nbsp;<span class="math inline">\([0, 1]\)</span></li>
<li><span class="math inline">\(odds = \frac{p}{1 - p}\)</span> &nbsp;&nbsp;&nbsp;<span class="math inline">\([0, \infty)\)</span></li>
<li><span class="math inline">\(log(odds) = log(\frac{p}{1 - p})\)</span> &nbsp;&nbsp;&nbsp;<span class="math inline">\((-\infty, \infty)\)</span></li>
</ul>
<p>The function that transforms <span class="math inline">\(p\)</span> to log-odds is called</p>
<ul>
<li><span class="math inline">\(logit(p) = log(\frac{p}{1 - p})\)</span></li>
</ul>
<p>The linear model is nested in the inverse logit, <span class="math inline">\(logit^{-1}\)</span>, that restricts the output of <span class="math inline">\(p\)</span> to the interval [0, 1]:</p>
<ul>
<li><span class="math inline">\(p_i = logit^{-1}(b_0 + b_1x_i)\)</span></li>
</ul>
<p>As seen in the left-hand figure below, when the output of the linear model (<span class="math inline">\(b_0 + b_1x_i\)</span>) goes below -4 or above +4, the predicted probability (the output of the inverse-logit) is close to zero and one, respectively. When the linear model is zero, the probability is 0.5.</p>
<p><br></p>
<p><strong>inverse-logit() and logit()</strong>:</p>
<ul>
<li><span class="math inline">\(p = logit^{-1}(b_0 + b_1x_i) = \frac{e^{b_0 + b_1x_i}}{1 + e^{b_0 + b_1x_i}}\)</span>, or in R: <code>plogis()</code>.</li>
<li><span class="math inline">\(logit(p_i) = log(\frac{p_1}{1-pi}) = b_0 + b_ix_i\)</span>, or in R: <code>qlogis()</code></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of logistic() = inv_logit()</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, p, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Linear model: b0 + b1x"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">" p = inverse-logit(b0 + b1x)"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">1</span>,<span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side =</span> <span class="dv">3</span>, <span class="at">text =</span> <span class="st">"inverse-logit()"</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of logit()</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">qlogis</span>(p)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, x, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"p"</span>, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"logit(p) = b0 + b1x"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side =</span> <span class="dv">3</span>, <span class="at">text =</span> <span class="st">"logit()"</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Here is an example from <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span> (fig 13.1b. p, 218) for a simple model with one predictor:</p>
<p><span class="math inline">\(y_i \sim Bernoulli(p_i)\)</span><br>
<span class="math inline">\(p_i = logit^{-1}(-1.4 + 0.33x_i)\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1.4</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">0.33</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, b0 <span class="sc">+</span> b1<span class="sc">*</span>x, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">ylab =</span> <span class="st">"log-odds = -1.4 + 0.33x"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side =</span> <span class="dv">3</span>, <span class="at">text =</span> <span class="st">"Linear model"</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (<span class="fu">exp</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x)))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">ylab =</span> <span class="st">"p = inv-logit(-1.4 + 0.33x)"</span>, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">xlab =</span> <span class="st">"x"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">1</span>,<span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side =</span> <span class="dv">3</span>, <span class="at">text =</span> <span class="st">"inv-logit(Linear model)"</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>In their example, the function predicted the probability of supporting George Bush in the 1992 presidential election, as a function of income level from 1 to 5 (see their figure 13.2). But here I will assume another story, to justify looking at the function in its full range. So, let’s assume that y is a binary outcome variable indicating success (1) or failure (0) in solving a not too-easy mathematical problem, and x is a mean-centered variable representing the amount of mathematical training of the problem solver (-20 is the amount of training of a 7-year old school kid, +20 of a Ph.D.&nbsp;in mathematics, and 0 is the mean amount of training in the population).</p>
<p>Let’s simulate data, using rbinom(), plot data and fit data to a logistic model using <code>glm()</code> (please try <code>rstanarm::stan_glm()</code>). ``</p>
<div class="cell" data-fig.heigth="5" data-warnings="false">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>), <span class="dv">100</span>)  <span class="co"># Exposure</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="sc">-</span><span class="fl">1.4</span> <span class="sc">+</span> <span class="fl">0.33</span><span class="sc">*</span>x)  <span class="co"># Probability of outcome = 1</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">length</span>(x), <span class="dv">1</span>, <span class="at">prob =</span> pp) <span class="co"># Data: 0 or 1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot, with transparent colors</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>jitter <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="fl">0.02</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="sc">+</span> jitter, y, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.02</span>), <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"P(y = 1)"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Model using glm()</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>xline <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>yline <span class="ot">&lt;-</span> <span class="fu">plogis</span>(m<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="sc">+</span> m<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>xline)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xline, yline, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(m), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           x 
      -1.40        0.33 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">confint</span>(m), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5 % 97.5 %
(Intercept) -1.54  -1.26
x            0.31   0.35</code></pre>
</div>
</div>
<p><br></p>
<p><strong>Interpretations of intercept, <span class="math inline">\(b_0 = -1.4\)</span></strong></p>
<ul>
<li>This is the output (log-odds) of the linear model when x = 0, in this case for individuals with average mathematical training. Converting this to probability yields: <span class="math inline">\(\frac{exp(-1.4)}{1 + exp(-1.4)} \approx 0.2\)</span>. That is, according to the model, about 20 % of people with average amount of mathematical training would solve the mathematical problem.</li>
</ul>
<p><strong>Interpretations of slope, <span class="math inline">\(b_1 = 0.33\)</span></strong></p>
<ul>
<li><span class="math inline">\(exp(b_1)\)</span> is the odds ratio comparing groups defined by x and x+1. In the example above, <span class="math inline">\(b_1 = 0.33\)</span>, so <span class="math inline">\(exp(b_1) = 1.39 = \frac{Odds(y = 1|x+1)}{Odds(y = 1|x)}\)</span> .</li>
<li>Interpretation of <span class="math inline">\(b_1\)</span> in terms of relative risk (RR) or risk difference (RD) is more complicated. Unlike the odds ratio (OR), which is the same for any comparison of x with x+1, the RD and RR depend on the value of x for which the comparison is done, see illustration in figure below.</li>
<li>Rule-of-thumb for the risk difference: <span class="math inline">\(b_1/4\)</span> is the upper limit for difference in risk, <span class="math inline">\(p\)</span>, between groups defined by x and x+1 (Gelman et al’s “Divide-by-4 rule”, p.&nbsp;220). In the example above, <span class="math inline">\(b_1 = 0.33\)</span> and <span class="math inline">\(b_1/4 = 0.08\)</span>, so a difference in one unit on x corresponds to a difference of at most 0.08 in <span class="math inline">\(p\)</span> (i.e., risk difference of no more than 8 % for a one-unit difference in x).</li>
</ul>
<p><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1.4</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">0.33</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> (<span class="fu">exp</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x0) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x0)))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x0 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> (<span class="fu">exp</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x1) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x1)))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>rd <span class="ot">&lt;-</span> y1 <span class="sc">-</span> y0</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">&lt;-</span> y1<span class="sc">/</span>y0</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>or <span class="ot">&lt;-</span> (y1<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>y1)) <span class="sc">/</span> (y0<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>y0))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Data and logistic function</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>jitter <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="fl">0.02</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="sc">+</span> jitter, y, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.02</span>), <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"Pr(y = 1|x)"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x0, y0, <span class="at">col =</span> <span class="st">"darkred"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Effect measures: RD, RR, OR</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">pch =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Effect size per unit change in x"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x0, rd, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x0, rr, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x0, or, <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to fig</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">labels =</span> <span class="st">"Risk difference"</span>, </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fl">0.95</span>, <span class="at">labels =</span> <span class="st">"Relative risk"</span>, </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fl">1.45</span>, <span class="at">labels =</span> <span class="st">"Odds ratio"</span>, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"darkgreen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="logistic-regression-with-just-an-intercept" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="logistic-regression-with-just-an-intercept">Logistic regression with just an intercept</h3>
<p>As we noted earlier for linear regression (Notes 10): <em>Estimating the mean is the</em> <em>same as regressing on a constant</em>.</p>
<p><span class="math inline">\(y_i \sim Normal(\mu, \sigma)\)</span><br>
<span class="math inline">\(\mu = b_0\)</span>,</p>
<p>where <span class="math inline">\(b_0\)</span> is the estimate of the population mean.</p>
<p>The same holds for logistic regression, where the mean is the probability of y = 1.</p>
<p><span class="math inline">\(y_i \sim Bernoulli(p)\)</span><br>
<span class="math inline">\(p = logit^{-1}(b_0)\)</span>,</p>
<p>where <span class="math inline">\(b_0\)</span> is the log-odds, and <span class="math inline">\(p = logit^{-1}(b_0) = \frac{exp(b_0)}{1 + exp(b_0)}\)</span></p>
<p>In the Aspirin experiment, the overall (marginal) proportion of heart attacks was 293 in 22,070 (so the sample proportion equals 0.013). We could use logistic regression to estimate the population proportion with a compatibility interval.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data from aspirin experiment</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">104</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10933</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">189</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10845</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>aspirin <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">104</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10933</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">189</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10845</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(aspirin, mi)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit intercpt-only model, display coefficients (log-odds)  </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>asp0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(mi <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span><span class="st">"logit"</span>), <span class="at">data =</span> a)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(asp0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  -4.308483 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(asp0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5 %    97.5 % 
-4.425954 -4.195331 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as probabilities, using the inverse-logit, in R called plogis()</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plogis</span>(<span class="fu">coef</span>(asp0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
 0.01327534 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plogis</span>(<span class="fu">confint</span>(asp0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5 %     97.5 % 
0.01182137 0.01484215 </code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="logistic-regression-with-a-single-binary-predictor" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="logistic-regression-with-a-single-binary-predictor">Logistic regression with a single binary predictor</h3>
<p>And as we noted earlier for linear regression (Notes 10): <em>Estimating a difference between two means is the same as regressing on an indicator variable</em>:</p>
<p><span class="math inline">\(y_i ~ Normal(\mu_i, \sigma)\)</span><br>
<span class="math inline">\(\mu_i = b_0 + b_iD_i\)</span>,</p>
<p>where <span class="math inline">\(D_i\)</span> is an indicator variable coded 0 for one group and 1 for the other. Thus, <span class="math inline">\(b_0\)</span> is the estimate of the population mean for group 0, and <span class="math inline">\(b_1\)</span> is an estimate of the difference between population group means.</p>
<p>Similarly for logistic regression:</p>
<p><span class="math inline">\(y_i ~ Bernouilli(p_i)\)</span><br>
<span class="math inline">\(p_i = logit^{-1}(b_0 + b_iD_i)\)</span>.</p>
<p>Here <span class="math inline">\(b_0\)</span> is the log-odds of group 0, and <span class="math inline">\(b_i\)</span> is the difference in log-odds between the two groups. Note that <span class="math inline">\(exp(b_1)\)</span> is the odds ratio of group 1 versus group 0. We may also convert to probabilities:</p>
<ul>
<li>Probability y = 1 for group 0: <span class="math inline">\(Pr(y = 1|D = 0) = logit^{-1}(b_0) = \frac{exp(b_0)}{1 + exp(b_0)}\)</span></li>
<li>Probability y = 1 for group 1: <span class="math inline">\(Pr(y = 1|D = 1) = logit^{-1}(b_0 + b_1) = \frac{exp(b_0 + b_1)}{1 + exp(b_0 + b_1)}\)</span></li>
</ul>
<p>Here I create a data frame with as many rows as participants in the Aspirin experiment (see Table above), and then I use logistic regression to fit the model (MI for myocardial infarction, coded 0 or 1)</p>
<p><span class="math inline">\(MI_i \sim Bernouilli(p_i)\)</span><br>
<span class="math inline">\(p_i = logit^{-1}(b_0 + b_1Aspirin_i)\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data from aspirin experiment</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">104</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10933</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">189</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10845</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>aspirin <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">104</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10933</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">189</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10845</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(aspirin, mi)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">aspirin =</span> a<span class="sc">$</span>aspirin, <span class="at">mi =</span> a<span class="sc">$</span>mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       mi
aspirin     0     1
      0 10845   189
      1 10933   104</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>aspfit <span class="ot">&lt;-</span> <span class="fu">glm</span>(mi <span class="sc">~</span> aspirin, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span><span class="st">"logit"</span>), <span class="at">data =</span> a)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aspfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = mi ~ aspirin, family = binomial(link = "logit"), 
    data = a)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -4.04971    0.07337 -55.195  &lt; 2e-16 ***
aspirin     -0.60544    0.12284  -4.929 8.28e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3114.7  on 22070  degrees of freedom
Residual deviance: 3089.3  on 22069  degrees of freedom
AIC: 3093.3

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<p><br></p>
<p>Converting <span class="math inline">\(b_0\)</span> to risk for placebo group, <span class="math inline">\(b_1\)</span> to odds ratio: aspirin/placebo, and <span class="math inline">\(b_0 + b_1\)</span> to risk of aspirin group.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficients</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> aspfit<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> aspfit<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform using plogis() and exp()</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>asp_estimates <span class="ot">&lt;-</span>        <span class="fu">c</span>(<span class="fu">plogis</span>(b0),      <span class="fu">plogis</span>(b0<span class="sc">+</span>b1),    <span class="fu">exp</span>(b1))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(asp_estimates) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"risk-placebo"</span>, <span class="st">"risk-aspirin"</span>, <span class="st">"odds ratio"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(asp_estimates, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>risk-placebo risk-aspirin   odds ratio 
      0.0171       0.0094       0.5458 </code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="arsenic-data" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="arsenic-data"><span class="header-section-number">16.3</span> Arsenic data</h2>
<p>Here example from <span class="citation" data-cites="gelman2020regression">Gelman et al. (<a href="references.html#ref-gelman2020regression" role="doc-biblioref">2021</a>)</span> from arsenic level in wells in Bangladesh and users decisions to switch to less polluted wells, for details, see p.&nbsp;234-237.</p>
<p><a href="https://bitbucket.org/matni/matni.bitbucket.org/raw/f2ab8616653393dd021d2ff2941deb908e2b905c/rmsnotes/datasets/wells.txt" target="blank">Follow this link to find data</a> Save (Ctrl+S on a PC) to download as text file</p>
<p><br> <strong>Code book:</strong></p>
<p>Measurements of wells and households, and follow registration of well-switching behavior at follow up a few years later.</p>
<ul>
<li><strong>switch</strong> Whether the household had switched wells at follow up.</li>
<li><strong>arsenic</strong> Arsenic level in units of hundreds of microgram per liter. Levels below 0.5 are considered “safe”.</li>
<li><strong>dist</strong> Distance in meters to closets safe well.</li>
<li><strong>dist100</strong> dist/100, so unit is 100-m.</li>
<li><strong>assoc</strong> Whether any members of the household are active in community organizations.</li>
<li><strong>educ</strong> The education level ff the household (years of education).</li>
<li><strong>educ4</strong> educ/4, so units i 4y-education.</li>
</ul>
<p><br></p>
<p>Import data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>wells <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"datasets/wells.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   3020 obs. of  7 variables:
 $ switch : int  1 1 0 1 1 1 1 1 1 1 ...
 $ arsenic: num  2.36 0.71 2.07 1.15 1.1 3.9 2.97 3.24 3.28 2.52 ...
 $ dist   : num  16.8 47.3 21 21.5 40.9 ...
 $ dist100: num  0.168 0.473 0.21 0.215 0.409 ...
 $ assoc  : int  0 0 0 0 1 1 1 0 1 1 ...
 $ educ   : int  0 0 10 12 14 9 4 10 0 0 ...
 $ educ4  : num  0 0 2.5 3 3.5 2.25 1 2.5 0 0 ...</code></pre>
</div>
</div>
<p><br></p>
<p>Summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wells, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     switch        arsenic          dist           dist100           assoc     
 Min.   :0.00   Min.   :0.51   Min.   :  0.39   Min.   :0.0039   Min.   :0.00  
 1st Qu.:0.00   1st Qu.:0.82   1st Qu.: 21.12   1st Qu.:0.2112   1st Qu.:0.00  
 Median :1.00   Median :1.30   Median : 36.76   Median :0.3676   Median :0.00  
 Mean   :0.58   Mean   :1.66   Mean   : 48.33   Mean   :0.4833   Mean   :0.42  
 3rd Qu.:1.00   3rd Qu.:2.20   3rd Qu.: 64.04   3rd Qu.:0.6404   3rd Qu.:1.00  
 Max.   :1.00   Max.   :9.65   Max.   :339.53   Max.   :3.3953   Max.   :1.00  
      educ          educ4    
 Min.   : 0.0   Min.   :0.0  
 1st Qu.: 0.0   1st Qu.:0.0  
 Median : 5.0   Median :1.2  
 Mean   : 4.8   Mean   :1.2  
 3rd Qu.: 8.0   3rd Qu.:2.0  
 Max.   :17.0   Max.   :4.2  </code></pre>
</div>
</div>
<p><br></p>
<p><strong>Model with only distance as predictor</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="cf">switch</span> <span class="sc">~</span> dist100, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> wells, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_1, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ dist100
 observations: 3020
 predictors:   2
------
            Median MAD_SD
(Intercept)  0.6    0.1  
dist100     -0.6    0.1  

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<p><br></p>
<p>Visualize data and model prediction.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to jitter data points</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>jitter_binary <span class="ot">&lt;-</span> <span class="cf">function</span>(a, <span class="at">jitt =</span> <span class="fl">0.05</span>){</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(a <span class="sc">==</span> <span class="dv">0</span>, <span class="fu">runif</span>(<span class="fu">length</span>(a), <span class="dv">0</span>, jitt), <span class="fu">runif</span>(<span class="fu">length</span>(a), <span class="dv">1</span><span class="sc">-</span> jitt, <span class="dv">1</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>switch_jitter <span class="ot">&lt;-</span> <span class="fu">jitter_binary</span>(wells<span class="sc">$</span><span class="cf">switch</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot jittered data</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wells<span class="sc">$</span>dist100, wells<span class="sc">$</span>switch_jitter, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Distance (in 100-m) to nearest safe well"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_1)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>x)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, ypred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>Model with distance and arsenic level as predictor</strong></p>
<p>This is Gelman Fig. 13.10a</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model (Gelman et al. calls it fit_3)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fit_3 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="cf">switch</span> <span class="sc">~</span> dist100 <span class="sc">+</span> arsenic, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> wells, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_3, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ dist100 + arsenic
 observations: 3020
 predictors:   3
------
            Median MAD_SD
(Intercept)  0.00   0.08 
dist100     -0.90   0.10 
arsenic      0.46   0.04 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data, see Fig. 13.10 (left) in Gelman et al.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wells<span class="sc">$</span>dist100, wells<span class="sc">$</span>switch_jitter, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Distance (in 100-m) to nearest safe well"</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_3)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>arsenic <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">dist100 =</span> x, <span class="at">arsenic =</span> arsenic)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>dist100 <span class="sc">+</span> cf[<span class="dv">3</span>]<span class="sc">*</span>xx<span class="sc">$</span>arsenic)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  dist100 arsenic     ypred
1     0.0     0.5 0.5582066
2     0.1     0.5 0.5359890
3     0.2     0.5 0.5136276
4     0.3     0.5 0.4912115
5     0.4     0.5 0.4688307
6     0.5     0.5 0.4465747</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with two levels of arsenic (low = 0.5, high = 1)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> <span class="fl">0.5</span>], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> <span class="fl">0.5</span>], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> <span class="dv">1</span>], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> <span class="dv">1</span>], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.53</span>, <span class="at">labels =</span> <span class="st">"If As = 1"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.3</span>, <span class="at">y =</span> <span class="fl">0.37</span>, <span class="at">labels =</span> <span class="st">"If As = 0.5"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Here with lines for arsenic-level corresponding to the 5, 50, and 95th percentile, respectively. I show it on the log-odds scale (left) and on the the probability scale (as Gelman et al).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot, with outcome on log-odds scale ----</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Distance (in 100-m) to nearest safe well"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"log-odds (Pr(switching | distance))"</span>, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_3)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>arsenic <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>arsenic, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">dist100 =</span> x, <span class="at">arsenic =</span> arsenic)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span>cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>dist100 <span class="sc">+</span> cf[<span class="dv">3</span>]<span class="sc">*</span>xx<span class="sc">$</span>arsenic</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  dist100 arsenic        ypred
1     0.0    0.56  0.261520296
2     0.1    0.56  0.171838913
3     0.2    0.56  0.082157530
4     0.3    0.56 -0.007523853
5     0.4    0.56 -0.097205236
6     0.5    0.56 -0.186886619</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of arsenic (5, 50, 95th)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">1.7</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">1</span>], <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.35</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">2</span>], <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.3</span>, <span class="at">y =</span> <span class="fl">1.8</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">3</span>], <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot data, probability scale see Fig. 13.10 (left) in Gelman et al. ----</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wells<span class="sc">$</span>dist100, wells<span class="sc">$</span>switch_jitter, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Distance (in 100-m) to nearest safe well"</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_3)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>arsenic <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>arsenic, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">dist100 =</span> x, <span class="at">arsenic =</span> arsenic)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>dist100 <span class="sc">+</span> cf[<span class="dv">3</span>]<span class="sc">*</span>xx<span class="sc">$</span>arsenic)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  dist100 arsenic     ypred
1     0.0    0.56 0.5650100
2     0.1    0.56 0.5428543
3     0.2    0.56 0.5205278
4     0.3    0.56 0.4981190
5     0.4    0.56 0.4757178
6     0.5    0.56 0.4534139</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of arsenic (5, 50, 95th)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>dist100[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">1</span>], <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.55</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">2</span>], <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.3</span>, <span class="at">y =</span> <span class="fl">0.85</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">3</span>], <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print arsenic levels displayed</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="at">As =</span> arsenic), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> As.5% As.50% As.95% 
  0.56   1.30   3.79 </code></pre>
</div>
</div>
<p><br></p>
<p>Here with lines for distances corresponding to the 5, 50, and 95th percentile, respectively (cf.&nbsp;Gelman et al., Fig 13.10b).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability scale, see Fig. 13.10 (left) in Gelman et al.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data, </span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wells<span class="sc">$</span>arsenic, wells<span class="sc">$</span>switch_jitter, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Arsenic concentration in well water"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_3)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.5</span>, <span class="at">to =</span> <span class="dv">8</span>, <span class="at">by =</span> <span class="fl">0.1</span>)  <span class="co"># arsenic levels from 0 to 6</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>dist100 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>dist100, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">arsenic =</span> x, <span class="at">dist100 =</span> dist100)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>dist100 <span class="sc">+</span> cf[<span class="dv">3</span>]<span class="sc">*</span>xx<span class="sc">$</span>arsenic)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  arsenic   dist100     ypred
1     0.5 0.0798645 0.5404770
2     0.6 0.0798645 0.5518923
3     0.7 0.0798645 0.5632531
4     0.8 0.0798645 0.5745479
5     0.9 0.0798645 0.5857655
6     1.0 0.0798645 0.5968948</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of dist100 (5, 50, 95th)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>arsenic[xx<span class="sc">$</span>dist100 <span class="sc">==</span> dist100[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>dist100 <span class="sc">==</span> dist100[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>arsenic[xx<span class="sc">$</span>dist100 <span class="sc">==</span> dist100[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>dist100 <span class="sc">==</span> dist100[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>arsenic[xx<span class="sc">$</span>dist100 <span class="sc">==</span> dist100[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>dist100 <span class="sc">==</span> dist100[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.28</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Dist:"</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>arsenic[<span class="dv">1</span>]), <span class="st">"m"</span>), </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.47</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Dist:"</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>arsenic[<span class="dv">2</span>]), <span class="st">"m"</span>), </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.3</span>, <span class="at">y =</span> <span class="fl">0.65</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Dist:"</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>arsenic[<span class="dv">3</span>]), <span class="st">"m"</span>), </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.79</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>Add interaction term to the model</strong>. Below with no centering.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model (Gelman et al. calls it fit_4)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fit_4 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="cf">switch</span> <span class="sc">~</span> dist100 <span class="sc">+</span> arsenic <span class="sc">+</span> dist100<span class="sc">:</span>arsenic, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> wells, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_4, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ dist100 + arsenic + dist100:arsenic
 observations: 3020
 predictors:   4
------
                Median MAD_SD
(Intercept)     -0.15   0.12 
dist100         -0.57   0.22 
arsenic          0.56   0.07 
dist100:arsenic -0.18   0.11 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<p><br></p>
<p>To help interpretation of coefficients, here the same model with centered predictors</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Centering</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>c_dist100 <span class="ot">&lt;-</span> wells<span class="sc">$</span>dist100 <span class="sc">-</span> <span class="fu">mean</span>(wells<span class="sc">$</span>dist100)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>c_arsenic <span class="ot">&lt;-</span> wells<span class="sc">$</span>arsenic <span class="sc">-</span> <span class="fu">mean</span>(wells<span class="sc">$</span>arsenic)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Model (Gelman et al. calls it fit_5, p. 244)</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>fit_5 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="cf">switch</span> <span class="sc">~</span> c_dist100 <span class="sc">+</span> c_arsenic <span class="sc">+</span> c_dist100<span class="sc">:</span>c_arsenic, </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> wells, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_5, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ c_dist100 + c_arsenic + c_dist100:c_arsenic
 observations: 3020
 predictors:   4
------
                    Median MAD_SD
(Intercept)          0.35   0.04 
c_dist100           -0.88   0.11 
c_arsenic            0.47   0.04 
c_dist100:c_arsenic -0.18   0.10 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>pred5 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit_5)  <span class="co"># Fitted value</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>res5 <span class="ot">&lt;-</span> wells<span class="sc">$</span><span class="cf">switch</span> <span class="sc">-</span> pred5  <span class="co"># Residual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p>Interpretation of the coefficients:</p>
<ul>
<li><strong>Intercept</strong> &nbsp;&nbsp;The estimated log-odds of switching if distance and arsenic is at their means (<code>c_dist100 = 0</code> and <code>c_arsenic = 0</code>). Use <span class="math inline">\(logit^{-1}(Intercept)\)</span> to express in probability units, in R you may use <code>plogis()</code>. In the model above, the intercept is 0.35, so the models estimate of the probability of switching if distance and arsenic is at their mean is <code>plogis(0.35)</code> or about 0.59.</li>
<li><strong>c_dist100</strong> &nbsp;&nbsp;Coefficient for distance on the logit scale (i.e., log-odds) if arsenic level is at its mean. We can use the divide-by-4 rule to see that one unit increase in dist100 would correspond to at most a difference of -0.22 on the probability scale (if interpreted causally, a reduction in probability of switching)</li>
<li><strong>c_arsenic</strong> &nbsp;&nbsp;Coefficient for arsenic on the logit scale (i.e., log-odds) if dist100 at its mean. We can use the divide-by-4 rule to see that one unit increase in c_arsenic would correspond to at most a difference of +0.12 on the probability scale (if interpreted causally, a reduction in probability of switching)</li>
<li><strong>c_dist100:c_arsenic</strong>. &nbsp;&nbsp;Can be seen in two ways:
<ul>
<li>For each additional unit of arsenic, the value -0.18 is added to the coefficient for distance. The coefficient is negative (-0.88), larger distance means lower probability of switching. This negative relationship will be stronger for each additional unit of arsenic.</li>
<li>For each additional unit of distance, the value -0.18 is added to the coefficient for arsenic. The coefficient is positive (0.47), higher levels means higher probability of switching. This positive relationship will be weaker for each additional unit of distance.</li>
</ul></li>
</ul>
<p><br></p>
<p>Plot the model (only way to really understand the interaction), left on the log-odds scale, right on the probability scale.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot, with outcome on log-odds scale ----</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Mean-centered dist100"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"log-odds (Pr(switching | distance))"</span>, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">3.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_5)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>arsenic <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>c_arsenic, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">c_dist100 =</span> x, <span class="at">c_arsenic =</span> arsenic)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>dxa <span class="ot">&lt;-</span> xx<span class="sc">$</span>c_dist100<span class="sc">*</span>xx<span class="sc">$</span>c_arsenic</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_dist100 <span class="sc">+</span> cf[<span class="dv">3</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_arsenic <span class="sc">+</span> cf[<span class="dv">4</span>]<span class="sc">*</span>xx<span class="sc">$</span>dxa</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  c_dist100 c_arsenic       dxa       ypred
1      -0.5  -1.09693 0.5484652  0.17707787
2      -0.4  -1.09693 0.4387722  0.10901440
3      -0.3  -1.09693 0.3290791  0.04095093
4      -0.2  -1.09693 0.2193861 -0.02711253
5      -0.1  -1.09693 0.1096930 -0.09517600
6       0.0  -1.09693 0.0000000 -0.16323946</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of arsenic (5, 50, 95th)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#text(x = -1, y = 0, labels = paste("As:", round(arsenic[1], 2)), pos = 4, cex = 0.8)</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#text(x = -1, y = 0.7, labels = paste("As:", round(arsenic[2], 2)), pos = 4, cex = 0.8)</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">#text(x = -1, y = 2.2, labels = paste("As:", round(arsenic[3], 2)), pos = 4, cex = 0.8)</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot data, probability scale see Fig. 13.10 (left) in Gelman et al. ----</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Mean-centered dist100"</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>, </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">3.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_5)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>arsenic <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>c_arsenic, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">c_dist100 =</span> x, <span class="at">c_arsenic =</span> arsenic)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>dxa <span class="ot">&lt;-</span> xx<span class="sc">$</span>c_dist100<span class="sc">*</span>xx<span class="sc">$</span>c_arsenic</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_dist100 <span class="sc">+</span> cf[<span class="dv">3</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_arsenic <span class="sc">+</span> cf[<span class="dv">4</span>]<span class="sc">*</span>xx<span class="sc">$</span>dxa)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  c_dist100 c_arsenic       dxa     ypred
1      -0.5  -1.09693 0.5484652 0.5441541
2      -0.4  -1.09693 0.4387722 0.5272266
3      -0.3  -1.09693 0.3290791 0.5102363
4      -0.2  -1.09693 0.2193861 0.4932223
5      -0.1  -1.09693 0.1096930 0.4762239
6       0.0  -1.09693 0.0000000 0.4592805</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of arsenic (5, 50, 95th)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_arsenic <span class="sc">==</span> arsenic[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>ma <span class="ot">&lt;-</span> <span class="fu">mean</span>(wells<span class="sc">$</span>arsenic)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.4</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">1</span>] <span class="sc">+</span> ma, <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.7</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">2</span>] <span class="sc">+</span> ma, <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.95</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"As:"</span>, <span class="fu">round</span>(arsenic[<span class="dv">3</span>] <span class="sc">+</span> ma, <span class="dv">2</span>)), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Note that the interaction term is negative, but that its size is uncertain. Below the posterior probability for the interaction, about 4 % above zero, so the 95 % compatibility interval includes zero.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>s5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(fit_5)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(s5) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"b0"</span>, <span class="st">"dist"</span>, <span class="st">"arsenic"</span>, <span class="st">"dxa"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(s5<span class="sc">$</span>dxa), <span class="at">main =</span> <span class="st">"Posterior prob. interaction"</span>, </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"c_dist100:c_arsenic"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.1</span>, <span class="fl">0.7</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"P(x &gt; 0) = "</span>, <span class="fu">round</span>(<span class="fu">mean</span>(s5<span class="sc">$</span>dxa <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="dv">3</span>)), </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">quantile</span>(s5<span class="sc">$</span>dxa, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">median</span>(s5<span class="sc">$</span>dxa), <span class="fl">0.1</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior interval</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_interval</span>(fit_5, <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          2.5%       97.5%
(Intercept)          0.2744100  0.42970803
c_dist100           -1.0821656 -0.67956972
c_arsenic            0.3903326  0.55106241
c_dist100:c_arsenic -0.3837574  0.01596276</code></pre>
</div>
</div>
<p><br></p>
<p><strong>Add social predictors</strong></p>
<p>Gelman et al’s model, p.&nbsp;252.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>c_educ4 <span class="ot">&lt;-</span> wells<span class="sc">$</span>educ4 <span class="sc">-</span> <span class="fu">mean</span>(wells<span class="sc">$</span>educ4)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>fit_8 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="cf">switch</span> <span class="sc">~</span> c_dist100 <span class="sc">+</span> c_arsenic <span class="sc">+</span> c_educ4 <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                      c_dist100<span class="sc">:</span>c_educ4 <span class="sc">+</span> c_arsenic<span class="sc">:</span>c_educ4,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>), <span class="at">data =</span> wells, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ c_dist100 + c_arsenic + c_educ4 + c_dist100:c_educ4 + 
       c_arsenic:c_educ4
 observations: 3020
 predictors:   6
------
                  Median MAD_SD
(Intercept)        0.3    0.0  
c_dist100         -0.9    0.1  
c_arsenic          0.5    0.0  
c_educ4            0.2    0.0  
c_dist100:c_educ4  0.3    0.1  
c_arsenic:c_educ4  0.1    0.0  

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="check-residuals-in-logistic-regression-optional" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="check-residuals-in-logistic-regression-optional"><span class="header-section-number">16.4</span> Check residuals in logistic regression (optional!)</h2>
<p>See Gelman et al.&nbsp;Section 14.5 (pp.&nbsp;253-256).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function is from Gelman et al. It calculates binned residuals.</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Input: x = fitted values (y-hat) or a predictor variable, y = residuals</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>binned_resids <span class="ot">&lt;-</span> <span class="cf">function</span> (x, y, <span class="at">nclass=</span><span class="fu">sqrt</span>(<span class="fu">length</span>(x))){</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  breaks.index <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">length</span>(x)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span>(nclass<span class="dv">-1</span>))<span class="sc">/</span>nclass)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  breaks <span class="ot">&lt;-</span> <span class="fu">c</span> (<span class="sc">-</span><span class="cn">Inf</span>, <span class="fu">sort</span>(x)[breaks.index], <span class="cn">Inf</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  xbreaks <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  x.binned <span class="ot">&lt;-</span> <span class="fu">as.numeric</span> (<span class="fu">cut</span> (x, breaks))</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nclass){</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    items <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))[x.binned<span class="sc">==</span>i]</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    x.range <span class="ot">&lt;-</span> <span class="fu">range</span>(x[items])</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(x[items])</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y[items])</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(items)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    sdev <span class="ot">&lt;-</span> <span class="fu">sd</span>(y[items])</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    output <span class="ot">&lt;-</span> <span class="fu">rbind</span> (output, <span class="fu">c</span>(xbar, ybar, n, x.range, <span class="dv">2</span><span class="sc">*</span>sdev<span class="sc">/</span><span class="fu">sqrt</span>(n)))</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span> (output) <span class="ot">&lt;-</span> <span class="fu">c</span> (<span class="st">"xbar"</span>, <span class="st">"ybar"</span>, <span class="st">"n"</span>, <span class="st">"x.lo"</span>, <span class="st">"x.hi"</span>, <span class="st">"2se"</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span> (<span class="at">binned=</span>output, <span class="at">xbreaks=</span>xbreaks))</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p>Plot binned residuals</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>pred8 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit_8)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>br8 <span class="ot">&lt;-</span> <span class="fu">binned_resids</span>(pred8, wells<span class="sc">$</span><span class="cf">switch</span><span class="sc">-</span>pred8, <span class="at">nclass=</span><span class="dv">40</span>)<span class="sc">$</span>binned</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">range</span>(br8[,<span class="dv">1</span>]), <span class="fu">range</span>(br8[,<span class="dv">2</span>],br8[,<span class="dv">6</span>],<span class="sc">-</span>br8[,<span class="dv">6</span>]),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Estimated  Pr (switching)"</span>, <span class="at">ylab=</span><span class="st">"Average residual"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Binned residual plot"</span>, <span class="at">mgp=</span><span class="fu">c</span>(<span class="dv">2</span>,.<span class="dv">5</span>,<span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(br8[,<span class="dv">1</span>], br8[,<span class="dv">6</span>], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(br8[,<span class="dv">1</span>], <span class="sc">-</span>br8[,<span class="dv">6</span>], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(br8[,<span class="dv">1</span>], br8[,<span class="dv">2</span>], <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span>.<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lines(lowess(pred8, wells$switch-pred8), col = "red", lty = 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p>Binned residuals with respect to predictors: Distance (left) and Arsenic level (right)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>br <span class="ot">&lt;-</span> <span class="fu">binned_resids</span>(wells<span class="sc">$</span>dist, wells<span class="sc">$</span><span class="cf">switch</span><span class="sc">-</span>pred8, <span class="at">nclass=</span><span class="dv">40</span>)<span class="sc">$</span>binned</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">range</span>(br[,<span class="dv">1</span>]), <span class="fu">range</span>(br[,<span class="dv">2</span>],br[,<span class="dv">6</span>],<span class="sc">-</span>br[,<span class="dv">6</span>]),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Distance to nearest safe well"</span>, <span class="at">ylab=</span><span class="st">"Average residual"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Binned residual plot"</span>, <span class="at">mgp=</span><span class="fu">c</span>(<span class="dv">2</span>,.<span class="dv">5</span>,<span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>n_within_bin <span class="ot">&lt;-</span> <span class="fu">length</span>(wells<span class="sc">$</span><span class="cf">switch</span>)<span class="sc">/</span><span class="fu">nrow</span>(br)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(br[,<span class="dv">1</span>], br[,<span class="dv">6</span>], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(br[,<span class="dv">1</span>], <span class="sc">-</span>br[,<span class="dv">6</span>], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(br[,<span class="dv">1</span>], br[,<span class="dv">2</span>], <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span>.<span class="dv">5</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(wells<span class="sc">$</span>dist, wells<span class="sc">$</span><span class="cf">switch</span><span class="sc">-</span>pred8), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Arsenic</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>br <span class="ot">&lt;-</span> <span class="fu">binned_resids</span>(wells<span class="sc">$</span>arsenic, wells<span class="sc">$</span><span class="cf">switch</span><span class="sc">-</span>pred8, <span class="at">nclass=</span><span class="dv">40</span>)<span class="sc">$</span>binned</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">range</span>(<span class="dv">0</span>,br[,<span class="dv">1</span>]), <span class="fu">range</span>(br[,<span class="dv">2</span>],br[,<span class="dv">6</span>],<span class="sc">-</span>br[,<span class="dv">6</span>]),</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Arsenic level"</span>, <span class="at">ylab=</span><span class="st">"Average residual"</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Binned residual plot"</span>, <span class="at">mgp=</span><span class="fu">c</span>(<span class="dv">2</span>,.<span class="dv">5</span>,<span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>))</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> (<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span> (br[,<span class="dv">1</span>], br[,<span class="dv">6</span>], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span> (br[,<span class="dv">1</span>], <span class="sc">-</span>br[,<span class="dv">6</span>], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span> (br[,<span class="dv">1</span>], br[,<span class="dv">2</span>], <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span>.<span class="dv">5</span>)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(wells<span class="sc">$</span>arsenic, wells<span class="sc">$</span><span class="cf">switch</span><span class="sc">-</span>pred8), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Gelman et al’s final model with log-arsenic, p.&nbsp;254.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>log_arsenic <span class="ot">&lt;-</span> <span class="fu">log</span>(wells<span class="sc">$</span>arsenic)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>c_log_arsenic <span class="ot">&lt;-</span> wells<span class="sc">$</span>log_arsenic <span class="sc">-</span> <span class="fu">mean</span>(wells<span class="sc">$</span>log_arsenic)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>fit_9 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="cf">switch</span> <span class="sc">~</span> c_dist100 <span class="sc">+</span> c_log_arsenic <span class="sc">+</span> c_educ4 <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                      c_dist100<span class="sc">:</span>c_educ4 <span class="sc">+</span> c_log_arsenic<span class="sc">:</span>c_educ4,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>), <span class="at">data =</span> wells, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_9, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ c_dist100 + c_log_arsenic + c_educ4 + c_dist100:c_educ4 + 
       c_log_arsenic:c_educ4
 observations: 3020
 predictors:   6
------
                      Median MAD_SD
(Intercept)            0.34   0.04 
c_dist100             -1.01   0.11 
c_log_arsenic          0.91   0.07 
c_educ4                0.18   0.04 
c_dist100:c_educ4      0.35   0.11 
c_log_arsenic:c_educ4  0.06   0.07 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<p><br></p>
<p>Plot the model to understand the distance:education interaction, left on the log-odds scale, right on the probability scale.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot, with outcome on log-odds scale ----</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Mean-centered dist100"</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"log-odds (Pr(switching | distance))"</span>, </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">3.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_9)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>edu <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>c_educ4, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">c_dist100 =</span> x, <span class="at">c_educ4 =</span> edu)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>dxe <span class="ot">&lt;-</span> xx<span class="sc">$</span>c_dist100<span class="sc">*</span>xx<span class="sc">$</span>c_educ4</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="co"># At arsenic = 0, so cf[3] and cf[5] are gone</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_dist100 <span class="sc">+</span> cf[<span class="dv">4</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_educ4 <span class="sc">+</span> cf[<span class="dv">5</span>]<span class="sc">*</span>xx<span class="sc">$</span>dxe</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  c_dist100   c_educ4       dxe     ypred
1      -0.5 -1.207119 0.6035596 0.8293254
2      -0.4 -1.207119 0.4828477 0.6869369
3      -0.3 -1.207119 0.3621358 0.5445483
4      -0.2 -1.207119 0.2414238 0.4021598
5      -0.1 -1.207119 0.1207119 0.2597712
6       0.0 -1.207119 0.0000000 0.1173826</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of education (5, 50, 95th)</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co">#text(x = -1, y = 0, labels = paste("As:", round(arsenic[1], 2)), pos = 4, cex = 0.8)</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co">#text(x = -1, y = 0.7, labels = paste("As:", round(arsenic[2], 2)), pos = 4, cex = 0.8)</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co">#text(x = -1, y = 2.2, labels = paste("As:", round(arsenic[3], 2)), pos = 4, cex = 0.8)</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot data, probability scale see Fig. 13.10 (left) in Gelman et al. ----</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Mean-centered dist100"</span>,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>, </span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">3.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions, in data-frame called xx</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_9)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>edu <span class="ot">&lt;-</span> <span class="fu">quantile</span>(wells<span class="sc">$</span>c_educ4, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">c_dist100 =</span> x, <span class="at">c_educ4 =</span> edu)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>dxe <span class="ot">&lt;-</span> xx<span class="sc">$</span>c_dist100<span class="sc">*</span>xx<span class="sc">$</span>c_educ4</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a><span class="co"># At arsenic = 0, so cf[3] and cf[5] are gone</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_dist100 <span class="sc">+</span> cf[<span class="dv">4</span>]<span class="sc">*</span>xx<span class="sc">$</span>c_educ4 <span class="sc">+</span> cf[<span class="dv">5</span>]<span class="sc">*</span>xx<span class="sc">$</span>dxe)</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  c_dist100   c_educ4       dxe     ypred
1      -0.5 -1.207119 0.6035596 0.6962123
2      -0.4 -1.207119 0.4828477 0.6652852
3      -0.3 -1.207119 0.3621358 0.6328698
4      -0.2 -1.207119 0.2414238 0.5992065
5      -0.1 -1.207119 0.1207119 0.5645800
6       0.0 -1.207119 0.0000000 0.5293120</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for model prediction with three levels of education (5, 50, 95th)</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">1</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">1</span>]], <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">2</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">2</span>]], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>c_dist100[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">3</span>]], xx<span class="sc">$</span>ypred[xx<span class="sc">$</span>c_educ4 <span class="sc">==</span> edu[<span class="dv">3</span>]], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text to plot</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">mean</span>(wells<span class="sc">$</span>educ)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.02</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Edu:"</span>, <span class="fu">round</span>(edu[<span class="dv">1</span>] <span class="sc">+</span> me, <span class="dv">1</span>), <span class="st">"y"</span>), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.4</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Edu:"</span>, <span class="fu">round</span>(edu[<span class="dv">2</span>] <span class="sc">+</span> me, <span class="dv">1</span>), <span class="st">"y"</span>), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Edu:"</span>, <span class="fu">round</span>(edu[<span class="dv">3</span>] <span class="sc">+</span> me, <span class="dv">1</span>), <span class="st">"y"</span>), <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>s9 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(fit_9)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(s9<span class="sc">$</span>c_dist100.c_educ4), <span class="at">main =</span> <span class="st">"DistxEdu interaction"</span>, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"c_dist100:c_educ4"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">quantile</span>(s9<span class="sc">$</span>c_dist100.c_educ4, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">median</span>(s9<span class="sc">$</span>c_dist100.c_educ4), <span class="fl">0.1</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="practice" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="practice">Practice</h2>
<p>The practice problems are labeled Easy (E), Medium (M), and Hard (H), (as in <span class="citation" data-cites="McElreath2020">McElreath (<a href="references.html#ref-McElreath2020" role="doc-biblioref">2020</a>)</span>).</p>
<section id="easy" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="easy">Easy</h3>
<div class="practice">
<p><strong>16E1.</strong></p>
<ol type="a">
<li><p>When is it safe to interpret the odds ratio (OR) as a relative risk (RR).</p></li>
<li><p>Is it always the case that OR &gt; RR?</p></li>
</ol>
</div>
<p><br></p>
<div class="practice">
<p><strong>16E2.</strong></p>
<p>Which of the following statements about logistic regression are true?</p>
<p>Select one or more alternatives:</p>
<ul>
<li><p>Assume that residuals are normally distributed</p></li>
<li><p>Estimates probabilities</p></li>
<li><p>Has higher power than linear regression</p></li>
<li><p>Can only be used with multiple predictors</p></li>
<li><p>Is defined for outcomes in the interval [-1, 1]</p></li>
<li><p>Involve a logit link function</p></li>
<li><p>Used to model binary outcomes</p></li>
<li><p>Can be used to fit an intercept only model to estimate a single proportion</p></li>
<li><p>The exponentiated intercept, <span class="math inline">\(exp(b_0)\)</span> can be interpreted as an odds ratio</p></li>
<li><p>Regression coefficients (“slopes”) divided by 4, <span class="math inline">\(b_1/4\)</span>, can be interpreted as an upper limit to the probability difference associated with a one-unit difference in the predictor</p></li>
</ul>
</div>
<p><br></p>
</section>
<section id="medium" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medium">Medium</h3>
<div class="practice">
<p><strong>16M1.</strong> Make sense of this: “In logistic regression variables are interacting with them selves: The effect of a variable X on the probability of outcome depends on the level of X!”</p>
</div>
<p><br></p>
<div class="practice">
<p><strong>16M2.</strong> Figure below is from the Bangladesh well-switching data discussed above.</p>
<ol type="a">
<li><p>Estimate by eye the predicted difference in probability of switching wells between people living 200 m compared to 0 m (next to) the nearest safe well.</p></li>
<li><p>Estimate by eye the odds ratio for the same comparison, between people living 200 compared to 0 m from the nearest well.</p></li>
</ol>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to jitter data points</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>jitter_binary <span class="ot">&lt;-</span> <span class="cf">function</span>(a, <span class="at">jitt =</span> <span class="fl">0.05</span>){</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(a <span class="sc">==</span> <span class="dv">0</span>, <span class="fu">runif</span>(<span class="fu">length</span>(a), <span class="dv">0</span>, jitt), <span class="fu">runif</span>(<span class="fu">length</span>(a), <span class="dv">1</span><span class="sc">-</span> jitt, <span class="dv">1</span>))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>wells<span class="sc">$</span>switch_jitter <span class="ot">&lt;-</span> <span class="fu">jitter_binary</span>(wells<span class="sc">$</span><span class="cf">switch</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot jittered data</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wells<span class="sc">$</span>dist100, wells<span class="sc">$</span>switch_jitter, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Distance (in 100-m) to nearest safe well"</span>,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Pr(switching | distance)"</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_1)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>ypred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(cf[<span class="dv">1</span>] <span class="sc">+</span> cf[<span class="dv">2</span>]<span class="sc">*</span>x)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, ypred)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid lines</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">3.5</span>, <span class="fl">0.25</span>)) { <span class="fu">lines</span>(<span class="fu">c</span>(j, j), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span><span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)}</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>)) { <span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">3.5</span>), <span class="fu">c</span>(j, j), <span class="at">lty =</span><span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="16-stat25_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<div class="practice">
<p><strong>16M3.</strong> Below regression estimate for the model displayed in 16M2. Use the coefficients to calculate answers to 16M2</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_1, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       binomial [logit]
 formula:      switch ~ dist100
 observations: 3020
 predictors:   2
------
            Median MAD_SD
(Intercept)  0.61   0.06 
dist100     -0.62   0.09 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="hard" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="hard">Hard</h3>
<div class="practice">
<p><strong>16H1.</strong> Revisit the well-switching data discussed above. Fit a model predicting well-switching from distance and arsenic-level as well as their interaction. Visualize and interpret the result.</p>
</div>
<p><br></p>
</section>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">(Session Info)</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.2 (2024-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 26100)

Matrix products: default


locale:
[1] LC_COLLATE=Swedish_Sweden.utf8  LC_CTYPE=Swedish_Sweden.utf8   
[3] LC_MONETARY=Swedish_Sweden.utf8 LC_NUMERIC=C                   
[5] LC_TIME=Swedish_Sweden.utf8    

time zone: Europe/Stockholm
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rstanarm_2.32.1 Rcpp_1.0.14    

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1     dplyr_1.1.4          farver_2.1.2        
 [4] loo_2.8.0            fastmap_1.2.0        tensorA_0.36.2.1    
 [7] shinystan_2.6.0      promises_1.3.3       shinyjs_2.1.0       
[10] digest_0.6.37        mime_0.13            lifecycle_1.0.4     
[13] StanHeaders_2.32.10  survival_3.7-0       magrittr_2.0.3      
[16] posterior_1.6.1      compiler_4.4.2       rlang_1.1.6         
[19] tools_4.4.2          igraph_2.1.4         yaml_2.3.10         
[22] knitr_1.50           htmlwidgets_1.6.4    pkgbuild_1.4.8      
[25] curl_6.4.0           plyr_1.8.9           RColorBrewer_1.1-3  
[28] dygraphs_1.1.1.6     abind_1.4-8          miniUI_0.1.2        
[31] grid_4.4.2           stats4_4.4.2         xts_0.14.1          
[34] xtable_1.8-4         inline_0.3.21        ggplot2_3.5.2       
[37] scales_1.4.0         gtools_3.9.5         MASS_7.3-61         
[40] cli_3.6.5            rmarkdown_2.29       reformulas_0.4.1    
[43] generics_0.1.4       RcppParallel_5.1.10  rstudioapi_0.17.1   
[46] reshape2_1.4.4       minqa_1.2.8          rstan_2.32.7        
[49] stringr_1.5.1        shinythemes_1.2.0    splines_4.4.2       
[52] bayesplot_1.13.0     parallel_4.4.2       matrixStats_1.5.0   
[55] base64enc_0.1-3      vctrs_0.6.5          V8_6.0.4            
[58] boot_1.3-31          Matrix_1.7-1         jsonlite_2.0.0      
[61] crosstalk_1.2.1      glue_1.8.0           nloptr_2.2.1        
[64] codetools_0.2-20     distributional_0.5.0 DT_0.33             
[67] stringi_1.8.7        gtable_0.3.6         later_1.4.2         
[70] QuickJSR_1.8.0       lme4_1.1-37          tibble_3.3.0        
[73] colourpicker_1.3.0   pillar_1.10.2        htmltools_0.5.8.1   
[76] R6_2.6.1             Rdpack_2.6.4         evaluate_1.0.3      
[79] shiny_1.11.1         lattice_0.22-6       markdown_2.0        
[82] rbibutils_2.3        backports_1.5.0      threejs_0.3.4       
[85] httpuv_1.6.16        rstantools_2.4.0     gridExtra_2.3       
[88] nlme_3.1-166         checkmate_2.3.2      xfun_0.52           
[91] zoo_1.8-14           pkgconfig_2.0.3     </code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-gelman2020regression" class="csl-entry" role="listitem">
Gelman, A., Hill, J., &amp; Vehtari, A. (2021). <em>Regression and other stories</em>. Cambridge University Press.
</div>
<div id="ref-McElreath2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: A bayesian course with examples in r and stan</em>. Chapman; Hall/CRC.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./15-method25.html" class="pagination-link" aria-label="M: Fallacies and paradoxes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">M: Fallacies and paradoxes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>